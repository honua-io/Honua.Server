FROM mcr.microsoft.com/dotnet/sdk:8.0 AS test

WORKDIR /app

# Copy solution and project files
COPY *.sln ./
COPY src/Honua.Cli.AI/*.csproj ./src/Honua.Cli.AI/
COPY tests/Honua.Cli.AI.Tests/*.csproj ./tests/Honua.Cli.AI.Tests/

# Restore dependencies
RUN dotnet restore

# Copy source code
COPY . .

# Run tests
WORKDIR /app/tests/Honua.Cli.AI.Tests
ENTRYPOINT ["dotnet", "test", "--logger", "trx;LogFileName=test-results.trx", "--logger", "console;verbosity=detailed"]
