@page "/playground"
<PageTitle>Component Playground - Honua MapSDK</PageTitle>

<div class="dashboard-container">
    <div class="dashboard-header">
        <div>
            <h1 class="dashboard-title">
                <MudIcon Icon="@Icons.Material.Filled.Science" Class="mr-2" />
                Component Playground
            </h1>
            <p class="dashboard-subtitle">
                Interactive testing environment for Honua MapSDK components. Experiment with properties and see changes in real-time.
            </p>
        </div>
    </div>

    <MudGrid>
        <!-- Left: Component Selector & Settings -->
        <MudItem xs="12" md="4" lg="3">
            <MudStack Spacing="3">
                <!-- Component Selector -->
                <MudPaper Class="pa-3" Elevation="2">
                    <div class="panel-header">
                        <h3 class="panel-title">Select Component</h3>
                    </div>
                    <MudSelect T="string" Label="Component" @bind-Value="_selectedComponent" Variant="Variant.Outlined" Margin="Margin.Dense">
                        <MudSelectItem Value="@("Map")">
                            <MudIcon Icon="@Icons.Material.Filled.Map" Size="Size.Small" Class="mr-2" />
                            HonuaMap
                        </MudSelectItem>
                        <MudSelectItem Value="@("DataGrid")">
                            <MudIcon Icon="@Icons.Material.Filled.TableChart" Size="Size.Small" Class="mr-2" />
                            HonuaDataGrid
                        </MudSelectItem>
                        <MudSelectItem Value="@("Chart")">
                            <MudIcon Icon="@Icons.Material.Filled.BarChart" Size="Size.Small" Class="mr-2" />
                            HonuaChart
                        </MudSelectItem>
                        <MudSelectItem Value="@("LayerList")">
                            <MudIcon Icon="@Icons.Material.Filled.Layers" Size="Size.Small" Class="mr-2" />
                            HonuaLayerList
                        </MudSelectItem>
                        <MudSelectItem Value="@("Popup")">
                            <MudIcon Icon="@Icons.Material.Filled.Info" Size="Size.Small" Class="mr-2" />
                            HonuaPopup
                        </MudSelectItem>
                        <MudSelectItem Value="@("Editor")">
                            <MudIcon Icon="@Icons.Material.Filled.Edit" Size="Size.Small" Class="mr-2" />
                            HonuaEditor
                        </MudSelectItem>
                        <MudSelectItem Value="@("CoordinateDisplay")">
                            <MudIcon Icon="@Icons.Material.Filled.GpsFixed" Size="Size.Small" Class="mr-2" />
                            HonuaCoordinateDisplay
                        </MudSelectItem>
                        <MudSelectItem Value="@("AttributeTable")">
                            <MudIcon Icon="@Icons.Material.Filled.TableView" Size="Size.Small" Class="mr-2" />
                            HonuaAttributeTable
                        </MudSelectItem>
                        <MudSelectItem Value="@("Print")">
                            <MudIcon Icon="@Icons.Material.Filled.Print" Size="Size.Small" Class="mr-2" />
                            HonuaPrint
                        </MudSelectItem>
                        <MudSelectItem Value="@("Timeline")">
                            <MudIcon Icon="@Icons.Material.Filled.Timeline" Size="Size.Small" Class="mr-2" />
                            HonuaTimeline
                        </MudSelectItem>
                        <MudSelectItem Value="@("Search")">
                            <MudIcon Icon="@Icons.Material.Filled.Search" Size="Size.Small" Class="mr-2" />
                            HonuaSearch
                        </MudSelectItem>
                        <MudSelectItem Value="@("FilterPanel")">
                            <MudIcon Icon="@Icons.Material.Filled.FilterAlt" Size="Size.Small" Class="mr-2" />
                            HonuaFilterPanel
                        </MudSelectItem>
                    </MudSelect>
                </MudPaper>

                <!-- Component Settings -->
                <MudPaper Class="pa-3" Elevation="2" Style="max-height: 600px; overflow-y: auto;">
                    <div class="panel-header">
                        <h3 class="panel-title">Component Properties</h3>
                        <MudIconButton Icon="@Icons.Material.Filled.Refresh" Size="Size.Small" OnClick="ResetProperties" />
                    </div>

                    @if (_selectedComponent == "Map")
                    {
                        <MudStack Spacing="2">
                            <MudTextField Label="Map Style URL" @bind-Value="_mapStyle" Variant="Variant.Outlined" Margin="Margin.Dense" />
                            <MudNumericField Label="Zoom Level" @bind-Value="_zoom" Min="0" Max="22" Variant="Variant.Outlined" Margin="Margin.Dense" />
                            <MudNumericField Label="Longitude" @bind-Value="_centerLng" Variant="Variant.Outlined" Margin="Margin.Dense" />
                            <MudNumericField Label="Latitude" @bind-Value="_centerLat" Variant="Variant.Outlined" Margin="Margin.Dense" />
                            <MudCheckBox Label="Enable Rotation" @bind-Value="_enableRotation" Dense="true" />
                            <MudCheckBox Label="Enable Pitch" @bind-Value="_enablePitch" Dense="true" />
                        </MudStack>
                    }
                    else if (_selectedComponent == "Chart")
                    {
                        <MudStack Spacing="2">
                            <MudSelect Label="Chart Type" @bind-Value="_chartType" Variant="Variant.Outlined" Margin="Margin.Dense">
                                <MudSelectItem Value="@("Histogram")">Histogram</MudSelectItem>
                                <MudSelectItem Value="@("Bar")">Bar Chart</MudSelectItem>
                                <MudSelectItem Value="@("Pie")">Pie Chart</MudSelectItem>
                                <MudSelectItem Value="@("Doughnut")">Doughnut</MudSelectItem>
                                <MudSelectItem Value="@("Line")">Line Chart</MudSelectItem>
                            </MudSelect>
                            <MudTextField Label="Field" @bind-Value="_chartField" Variant="Variant.Outlined" Margin="Margin.Dense" />
                            <MudTextField Label="Title" @bind-Value="_chartTitle" Variant="Variant.Outlined" Margin="Margin.Dense" />
                            <MudCheckBox Label="Show Legend" @bind-Value="_showLegend" Dense="true" />
                            <MudCheckBox Label="Enable Filter" @bind-Value="_enableFilter" Dense="true" />
                            <MudSelect Label="Legend Position" @bind-Value="_legendPosition" Variant="Variant.Outlined" Margin="Margin.Dense">
                                <MudSelectItem Value="@("top")">Top</MudSelectItem>
                                <MudSelectItem Value="@("bottom")">Bottom</MudSelectItem>
                                <MudSelectItem Value="@("left")">Left</MudSelectItem>
                                <MudSelectItem Value="@("right")">Right</MudSelectItem>
                            </MudSelect>
                        </MudStack>
                    }
                    else if (_selectedComponent == "LayerList")
                    {
                        <MudStack Spacing="2">
                            <MudCheckBox Label="Show Opacity Slider" @bind-Value="_showOpacitySlider" Dense="true" />
                            <MudCheckBox Label="Show Visibility Toggle" @bind-Value="_showVisibilityToggle" Dense="true" />
                            <MudCheckBox Label="Allow Reordering" @bind-Value="_allowReordering" Dense="true" />
                            <MudCheckBox Label="Show Search" @bind-Value="_showSearch" Dense="true" />
                            <MudCheckBox Label="Show Legend" @bind-Value="_showLayerLegend" Dense="true" />
                            <MudCheckBox Label="Group Layers" @bind-Value="_groupLayers" Dense="true" />
                        </MudStack>
                    }
                    else if (_selectedComponent == "CoordinateDisplay")
                    {
                        <MudStack Spacing="2">
                            <MudSelect Label="Format" @bind-Value="_coordFormat" Variant="Variant.Outlined" Margin="Margin.Dense">
                                <MudSelectItem Value="@("DD")">Decimal Degrees</MudSelectItem>
                                <MudSelectItem Value="@("DMS")">Degrees Minutes Seconds</MudSelectItem>
                                <MudSelectItem Value="@("UTM")">UTM</MudSelectItem>
                                <MudSelectItem Value="@("MGRS")">MGRS</MudSelectItem>
                                <MudSelectItem Value="@("PlusCode")">Plus Codes</MudSelectItem>
                            </MudSelect>
                            <MudNumericField Label="Precision" @bind-Value="_coordPrecision" Min="0" Max="12" Variant="Variant.Outlined" Margin="Margin.Dense" />
                            <MudCheckBox Label="Show Copy Button" @bind-Value="_showCopyButton" Dense="true" />
                            <MudCheckBox Label="Show Pin Button" @bind-Value="_showPinButton" Dense="true" />
                            <MudCheckBox Label="Show Measure Tools" @bind-Value="_showMeasureTools" Dense="true" />
                            <MudCheckBox Label="Show All Formats" @bind-Value="_showAllFormats" Dense="true" />
                        </MudStack>
                    }
                    else
                    {
                        <MudAlert Severity="Severity.Info">
                            Select a component to see available properties.
                        </MudAlert>
                    }

                    <MudDivider Class="my-3" />

                    <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" StartIcon="@Icons.Material.Filled.Refresh">
                        Apply Changes
                    </MudButton>
                </MudPaper>

                <!-- Code Snippet -->
                <MudPaper Class="pa-3" Elevation="2">
                    <div class="panel-header">
                        <h3 class="panel-title">Code Snippet</h3>
                        <MudIconButton Icon="@Icons.Material.Filled.ContentCopy" Size="Size.Small" OnClick="CopyCode" />
                    </div>
                    <div class="code-example" style="max-height: 300px; overflow-y: auto;">
                        <pre><code>@GetComponentCode()</code></pre>
                    </div>
                </MudPaper>
            </MudStack>
        </MudItem>

        <!-- Right: Preview -->
        <MudItem xs="12" md="8" lg="9">
            <MudPaper Elevation="2" Style="height: calc(100vh - 200px); position: relative;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px; border-radius: 8px 8px 0 0;">
                    <MudText Typo="Typo.h6">Live Preview</MudText>
                    <MudText Typo="Typo.body2">Changes update in real-time</MudText>
                </div>

                <div style="padding: 24px; height: calc(100% - 80px);">
                    @if (_selectedComponent == "Map")
                    {
                        <HonuaMap Id="playground-map"
                                  MapStyle="@_mapStyle"
                                  Center="new[] { _centerLng, _centerLat }"
                                  Zoom="_zoom"
                                  Style="width: 100%; height: 100%; border-radius: 8px;" />
                    }
                    else if (_selectedComponent == "Chart")
                    {
                        <div style="height: 100%; display: flex; align-items: center; justify-content: center;">
                            <div style="width: 80%; height: 80%;">
                                <HonuaChart Id="playground-chart"
                                            SyncWith="playground-map"
                                            Type="@(_chartType == "Histogram" ? ChartType.Histogram : ChartType.Bar)"
                                            Field="@_chartField"
                                            Title="@_chartTitle"
                                            ShowLegend="_showLegend"
                                            LegendPosition="@_legendPosition"
                                            EnableFilter="_enableFilter"
                                            Style="width: 100%; height: 100%;" />
                            </div>
                        </div>
                    }
                    else if (_selectedComponent == "LayerList")
                    {
                        <MudGrid Style="height: 100%;">
                            <MudItem xs="8" Style="height: 100%;">
                                <HonuaMap Id="playground-layerlist-map"
                                          MapStyle="https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json"
                                          Center="new[] { -122.4194, 37.7749 }"
                                          Zoom="13"
                                          Style="width: 100%; height: 100%; border-radius: 8px;" />
                            </MudItem>
                            <MudItem xs="4" Style="height: 100%;">
                                <HonuaLayerList Id="playground-layerlist"
                                                SyncWith="playground-layerlist-map"
                                                ShowOpacitySlider="_showOpacitySlider"
                                                ShowVisibilityToggle="_showVisibilityToggle"
                                                AllowReordering="_allowReordering"
                                                ShowSearch="_showSearch"
                                                ShowLegend="_showLayerLegend"
                                                GroupLayers="_groupLayers"
                                                Style="width: 100%; height: 100%;" />
                            </MudItem>
                        </MudGrid>
                    }
                    else if (_selectedComponent == "CoordinateDisplay")
                    {
                        <div style="height: 100%; position: relative;">
                            <HonuaMap Id="playground-coord-map"
                                      MapStyle="https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json"
                                      Center="new[] { -122.4194, 37.7749 }"
                                      Zoom="13"
                                      Style="width: 100%; height: 100%; border-radius: 8px;" />

                            <div style="position: absolute; bottom: 16px; left: 16px; right: 16px; background: white; border-radius: 8px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                                <HonuaCoordinateDisplay Id="playground-coord"
                                                        SyncWith="playground-coord-map"
                                                        Format="@_coordFormat"
                                                        Precision="_coordPrecision"
                                                        ShowCopyButton="_showCopyButton"
                                                        ShowPinButton="_showPinButton"
                                                        ShowMeasureTools="_showMeasureTools"
                                                        ShowAllFormats="_showAllFormats"
                                                        Style="width: 100%;" />
                            </div>
                        </div>
                    }
                    else
                    {
                        <div style="height: 100%; display: flex; align-items: center; justify-content: center; background: #F5F5F5; border-radius: 8px;">
                            <MudStack AlignItems="AlignItems.Center" Spacing="3">
                                <MudIcon Icon="@Icons.Material.Filled.Science" Size="Size.Large" Color="Color.Primary" Style="font-size: 100px;" />
                                <MudText Typo="Typo.h4" Color="Color.Secondary">Select a Component</MudText>
                                <MudText Typo="Typo.body1" Color="Color.Secondary">Choose a component from the sidebar to start experimenting</MudText>
                            </MudStack>
                        </div>
                    }
                </div>
            </MudPaper>
        </MudItem>
    </MudGrid>
</div>

@code {
    // Map properties
    private string _mapStyle = "https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json";
    private double _zoom = 13;
    private double _centerLng = -122.4194;
    private double _centerLat = 37.7749;
    private bool _enableRotation = true;
    private bool _enablePitch = true;

    // Chart properties
    private string _chartType = "Bar";
    private string _chartField = "landUse";
    private string _chartTitle = "Property Types";
    private bool _showLegend = true;
    private bool _enableFilter = true;
    private string _legendPosition = "bottom";

    // LayerList properties
    private bool _showOpacitySlider = true;
    private bool _showVisibilityToggle = true;
    private bool _allowReordering = true;
    private bool _showSearch = false;
    private bool _showLayerLegend = false;
    private bool _groupLayers = false;

    // CoordinateDisplay properties
    private string _coordFormat = "DD";
    private int _coordPrecision = 6;
    private bool _showCopyButton = true;
    private bool _showPinButton = false;
    private bool _showMeasureTools = false;
    private bool _showAllFormats = false;

    private string _selectedComponent = "Map";

    private void ResetProperties()
    {
        // Reset to defaults based on selected component
        if (_selectedComponent == "Map")
        {
            _mapStyle = "https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json";
            _zoom = 13;
            _centerLng = -122.4194;
            _centerLat = 37.7749;
        }
    }

    private string GetComponentCode()
    {
        return _selectedComponent switch
        {
            "Map" => $@"<HonuaMap Id=""my-map""
          MapStyle=""{_mapStyle}""
          Center=""new[] {{ {_centerLng}, {_centerLat} }}""
          Zoom=""{_zoom}""
          Style=""width: 100%; height: 100%;"" />",

            "Chart" => $@"<HonuaChart Id=""my-chart""
            SyncWith=""my-map""
            Type=""ChartType.{_chartType}""
            Field=""{_chartField}""
            Title=""{_chartTitle}""
            ShowLegend=""{_showLegend.ToString().ToLower()}""
            LegendPosition=""{_legendPosition}""
            EnableFilter=""{_enableFilter.ToString().ToLower()}"" />",

            "LayerList" => $@"<HonuaLayerList Id=""layer-list""
                SyncWith=""my-map""
                ShowOpacitySlider=""{_showOpacitySlider.ToString().ToLower()}""
                ShowVisibilityToggle=""{_showVisibilityToggle.ToString().ToLower()}""
                AllowReordering=""{_allowReordering.ToString().ToLower()}""
                ShowSearch=""{_showSearch.ToString().ToLower()}""
                GroupLayers=""{_groupLayers.ToString().ToLower()}"" />",

            "CoordinateDisplay" => $@"<HonuaCoordinateDisplay Id=""coords""
                        SyncWith=""my-map""
                        Format=""{_coordFormat}""
                        Precision=""{_coordPrecision}""
                        ShowCopyButton=""{_showCopyButton.ToString().ToLower()}""
                        ShowPinButton=""{_showPinButton.ToString().ToLower()}"" />",

            _ => "// Select a component to see code"
        };
    }

    private void CopyCode()
    {
        // Copy code to clipboard
    }
}
