@page "/dashboards/asset-management"
<PageTitle>Asset Management Dashboard - Honua MapSDK</PageTitle>

<div class="dashboard-container">
    <div class="dashboard-header">
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
            <div>
                <h1 class="dashboard-title">
                    <MudIcon Icon="@Icons.Material.Filled.AccountTree" Class="mr-2" />
                    Infrastructure Asset Management
                </h1>
                <p class="dashboard-subtitle">
                    Track and manage infrastructure assets with maintenance schedules, condition assessments, and lifecycle analysis.
                </p>
            </div>
            <MudChip Color="Color.Success" Icon="@Icons.Material.Filled.CheckCircle">
                3,847 Assets Active
            </MudChip>
        </div>
    </div>

    <!-- Key Metrics -->
    <MudGrid Class="mb-4">
        <MudItem xs="12" sm="6" md="3">
            <MudPaper Class="pa-3" Elevation="2">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <div>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Total Assets</MudText>
                        <MudText Typo="Typo.h4">3,847</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Success">+12 this month</MudText>
                    </div>
                    <MudIcon Icon="@Icons.Material.Filled.Inventory" Color="Color.Primary" Size="Size.Large" />
                </MudStack>
            </MudPaper>
        </MudItem>
        <MudItem xs="12" sm="6" md="3">
            <MudPaper Class="pa-3" Elevation="2">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <div>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Needs Maintenance</MudText>
                        <MudText Typo="Typo.h4" Color="Color.Warning">127</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Warning">3.3% of total</MudText>
                    </div>
                    <MudIcon Icon="@Icons.Material.Filled.Build" Color="Color.Warning" Size="Size.Large" />
                </MudStack>
            </MudPaper>
        </MudItem>
        <MudItem xs="12" sm="6" md="3">
            <MudPaper Class="pa-3" Elevation="2">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <div>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Critical Issues</MudText>
                        <MudText Typo="Typo.h4" Color="Color.Error">8</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Error">Requires immediate attention</MudText>
                    </div>
                    <MudIcon Icon="@Icons.Material.Filled.Warning" Color="Color.Error" Size="Size.Large" />
                </MudStack>
            </MudPaper>
        </MudItem>
        <MudItem xs="12" sm="6" md="3">
            <MudPaper Class="pa-3" Elevation="2">
                <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                    <div>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Asset Value</MudText>
                        <MudText Typo="Typo.h4">$47.2M</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Success">Replacement cost</MudText>
                    </div>
                    <MudIcon Icon="@Icons.Material.Filled.AttachMoney" Color="Color.Success" Size="Size.Large" />
                </MudStack>
            </MudPaper>
        </MudItem>
    </MudGrid>

    <MudGrid>
        <!-- Left: Layers and Filters -->
        <MudItem xs="12" md="3">
            <MudStack Spacing="3">
                <!-- Asset Type Filter -->
                <MudPaper Class="pa-3" Elevation="2">
                    <div class="panel-header">
                        <h3 class="panel-title">
                            <MudIcon Icon="@Icons.Material.Filled.Category" Size="Size.Small" Class="mr-1" />
                            Asset Types
                        </h3>
                    </div>
                    <MudStack Spacing="1">
                        <MudCheckBox Label="Water Infrastructure" Checked="true" Dense="true" Color="Color.Primary" />
                        <MudCheckBox Label="Electrical Grid" Checked="true" Dense="true" Color="Color.Warning" />
                        <MudCheckBox Label="Transportation" Checked="true" Dense="true" Color="Color.Success" />
                        <MudCheckBox Label="Telecommunications" Dense="true" Color="Color.Info" />
                        <MudCheckBox Label="Public Buildings" Checked="true" Dense="true" Color="Color.Secondary" />
                        <MudCheckBox Label="Parks & Recreation" Dense="true" Color="Color.Tertiary" />
                    </MudStack>
                </MudPaper>

                <!-- Condition Filter -->
                <MudPaper Class="pa-3" Elevation="2">
                    <div class="panel-header">
                        <h3 class="panel-title">
                            <MudIcon Icon="@Icons.Material.Filled.HealthAndSafety" Size="Size.Small" Class="mr-1" />
                            Condition
                        </h3>
                    </div>
                    <MudStack Spacing="1">
                        <MudCheckBox Label="Excellent" Checked="true" Dense="true">
                            <MudChip Size="Size.Small" Color="Color.Success" Style="margin-left: auto;">1,234</MudChip>
                        </MudCheckBox>
                        <MudCheckBox Label="Good" Checked="true" Dense="true">
                            <MudChip Size="Size.Small" Color="Color.Primary" Style="margin-left: auto;">1,892</MudChip>
                        </MudCheckBox>
                        <MudCheckBox Label="Fair" Checked="true" Dense="true">
                            <MudChip Size="Size.Small" Color="Color.Warning" Style="margin-left: auto;">594</MudChip>
                        </MudCheckBox>
                        <MudCheckBox Label="Poor" Checked="true" Dense="true">
                            <MudChip Size="Size.Small" Color="Color.Error" Style="margin-left: auto;">127</MudChip>
                        </MudCheckBox>
                    </MudStack>
                </MudPaper>

                <!-- Coordinate Display -->
                <MudPaper Class="pa-3" Elevation="2">
                    <HonuaCoordinateDisplay Id="asset-coords"
                                            SyncWith="asset-map"
                                            Format="DecimalDegrees"
                                            Precision="6"
                                            ShowCopyButton="true"
                                            ShowPinButton="true"
                                            Style="width: 100%;" />
                </MudPaper>

                <!-- Quick Actions -->
                <MudPaper Class="pa-3" Elevation="2">
                    <div class="panel-header">
                        <h3 class="panel-title">Quick Actions</h3>
                    </div>
                    <MudStack Spacing="2">
                        <MudButton Variant="Variant.Outlined" FullWidth="true" StartIcon="@Icons.Material.Filled.Add">
                            Add Asset
                        </MudButton>
                        <MudButton Variant="Variant.Outlined" FullWidth="true" StartIcon="@Icons.Material.Filled.Schedule">
                            Schedule Maintenance
                        </MudButton>
                        <MudButton Variant="Variant.Outlined" FullWidth="true" StartIcon="@Icons.Material.Filled.Assignment">
                            Work Order
                        </MudButton>
                        <MudButton Variant="Variant.Outlined" FullWidth="true" StartIcon="@Icons.Material.Filled.Download">
                            Export Report
                        </MudButton>
                    </MudStack>
                </MudPaper>
            </MudStack>
        </MudItem>

        <!-- Center: Map -->
        <MudItem xs="12" md="6">
            <MudStack Spacing="3">
                <MudPaper Elevation="2" Style="height: 550px; position: relative;">
                    <HonuaMap Id="asset-map"
                              MapStyle="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json"
                              Center="new[] { -122.4194, 37.7749 }"
                              Zoom="13"
                              Style="width: 100%; height: 100%; border-radius: 8px;" />

                    <!-- Map Controls -->
                    <div style="position: absolute; top: 16px; left: 16px; background: rgba(30,30,30,0.9); border-radius: 8px; padding: 8px; display: flex; gap: 8px;">
                        <MudTooltip Text="Select Asset">
                            <MudIconButton Icon="@Icons.Material.Filled.TouchApp" Color="Color.Primary" Size="Size.Small" Style="color: white;" />
                        </MudTooltip>
                        <MudTooltip Text="Measure Distance">
                            <MudIconButton Icon="@Icons.Material.Filled.Straighten" Color="Color.Default" Size="Size.Small" Style="color: white;" />
                        </MudTooltip>
                        <MudTooltip Text="Search Asset">
                            <MudIconButton Icon="@Icons.Material.Filled.Search" Color="Color.Default" Size="Size.Small" Style="color: white;" />
                        </MudTooltip>
                    </div>

                    <HonuaLayerList Id="asset-layers"
                                    SyncWith="asset-map"
                                    ShowOpacitySlider="true"
                                    ShowVisibilityToggle="true"
                                    ShowLegend="true"
                                    Style="position: absolute; top: 16px; right: 16px; width: 250px; background: rgba(30,30,30,0.9); border-radius: 8px; padding: 12px; color: white;" />

                    <HonuaPopup Id="asset-popup"
                                SyncWith="asset-map"
                                TriggerMode="PopupTrigger.Click"
                                ShowCloseButton="true"
                                MaxWidth="450px">
                        <ContentTemplate Context="feature">
                            <MudCard>
                                <MudCardHeader Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.h6" Style="color: white;">@feature.Properties["assetName"]</MudText>
                                        <MudText Typo="Typo.body2" Style="color: rgba(255,255,255,0.8);">ID: @feature.Properties["assetId"]</MudText>
                                    </CardHeaderContent>
                                    <CardHeaderActions>
                                        <MudChip Size="Size.Small" Color="Color.Success" Style="color: white;">@feature.Properties["condition"]</MudChip>
                                    </CardHeaderActions>
                                </MudCardHeader>
                                <MudCardContent>
                                    <MudGrid>
                                        <MudItem xs="6">
                                            <MudText Typo="Typo.caption">Type</MudText>
                                            <MudText Typo="Typo.body2"><strong>@feature.Properties["assetType"]</strong></MudText>
                                        </MudItem>
                                        <MudItem xs="6">
                                            <MudText Typo="Typo.caption">Install Date</MudText>
                                            <MudText Typo="Typo.body2"><strong>@feature.Properties["installDate"]</strong></MudText>
                                        </MudItem>
                                        <MudItem xs="6">
                                            <MudText Typo="Typo.caption">Last Maintenance</MudText>
                                            <MudText Typo="Typo.body2"><strong>@feature.Properties["lastMaintenance"]</strong></MudText>
                                        </MudItem>
                                        <MudItem xs="6">
                                            <MudText Typo="Typo.caption">Next Maintenance</MudText>
                                            <MudText Typo="Typo.body2" Color="Color.Warning"><strong>@feature.Properties["nextMaintenance"]</strong></MudText>
                                        </MudItem>
                                    </MudGrid>
                                    <MudDivider Class="my-2" />
                                    <MudText Typo="Typo.caption">Replacement Value</MudText>
                                    <MudText Typo="Typo.h6" Color="Color.Success">$@feature.Properties["replacementValue"]</MudText>
                                </MudCardContent>
                                <MudCardActions>
                                    <MudButton Variant="Variant.Text" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Edit">Edit</MudButton>
                                    <MudButton Variant="Variant.Text" Color="Color.Secondary" StartIcon="@Icons.Material.Filled.History">History</MudButton>
                                    <MudButton Variant="Variant.Text" Color="Color.Info" StartIcon="@Icons.Material.Filled.Schedule">Schedule</MudButton>
                                </MudCardActions>
                            </MudCard>
                        </ContentTemplate>
                    </HonuaPopup>

                    <HonuaSearch Id="asset-search"
                                 SyncWith="asset-map"
                                 Placeholder="Search assets..."
                                 Style="position: absolute; top: 16px; left: 50%; transform: translateX(-50%); width: 300px;" />
                </MudPaper>

                <!-- Timeline -->
                <MudPaper Elevation="2" Style="height: 250px;">
                    <HonuaTimeline Id="asset-timeline"
                                   SyncWith="asset-map"
                                   TimeField="maintenanceDate"
                                   Title="Maintenance Timeline"
                                   ShowPlaybackControls="true"
                                   ShowDateRange="true"
                                   AnimationSpeed="1000"
                                   Style="width: 100%; height: 100%;" />
                </MudPaper>
            </MudStack>
        </MudItem>

        <!-- Right: Data & Analytics -->
        <MudItem xs="12" md="3">
            <MudStack Spacing="3">
                <!-- Asset Condition Chart -->
                <MudPaper Elevation="2" Class="pa-3" Style="height: 250px;">
                    <HonuaChart Id="asset-condition-chart"
                                SyncWith="asset-map"
                                Type="ChartType.Doughnut"
                                Field="condition"
                                Title="Asset Condition"
                                ShowLegend="true"
                                LegendPosition="bottom"
                                EnableFilter="true"
                                Style="width: 100%; height: 100%;" />
                </MudPaper>

                <!-- Maintenance Timeline Chart -->
                <MudPaper Elevation="2" Class="pa-3" Style="height: 250px;">
                    <HonuaChart Id="asset-type-chart"
                                SyncWith="asset-map"
                                Type="ChartType.Bar"
                                Field="assetType"
                                Title="Assets by Type"
                                Aggregation="AggregationType.Count"
                                EnableFilter="true"
                                Style="width: 100%; height: 100%;" />
                </MudPaper>

                <!-- Legend -->
                <MudPaper Class="pa-3" Elevation="2">
                    <div class="panel-header">
                        <h3 class="panel-title">
                            <MudIcon Icon="@Icons.Material.Filled.Info" Size="Size.Small" Class="mr-1" />
                            Map Legend
                        </h3>
                    </div>
                    <HonuaLegend Id="asset-legend"
                                 SyncWith="asset-map"
                                 ShowLayerNames="true"
                                 Collapsible="true"
                                 Style="width: 100%;" />
                </MudPaper>
            </MudStack>
        </MudItem>
    </MudGrid>

    <!-- Asset Table -->
    <MudPaper Elevation="2" Class="mt-4" Style="height: 400px;">
        <HonuaAttributeTable Id="asset-table"
                             SyncWith="asset-map"
                             DataSource="data/assets.geojson"
                             Title="Asset Inventory"
                             ShowToolbar="true"
                             AllowColumnSort="true"
                             AllowColumnFilter="true"
                             ShowQuickFilter="true"
                             AllowInlineEdit="true"
                             ShowExport="true"
                             Dense="true"
                             PageSize="15"
                             Style="width: 100%; height: 100%;" />
    </MudPaper>
</div>
