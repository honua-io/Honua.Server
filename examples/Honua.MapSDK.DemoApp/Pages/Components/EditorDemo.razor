@page "/components/editor"
<PageTitle>Editor Demo - Honua MapSDK</PageTitle>

<div class="dashboard-container">
    <div class="dashboard-header">
        <div>
            <h1 class="dashboard-title">
                <MudIcon Icon="@Icons.Material.Filled.Edit" Class="mr-2" />
                HonuaEditor Component
            </h1>
            <p class="dashboard-subtitle">
                Draw and edit features with attribute editing, undo/redo, and save/cancel workflow.
            </p>
        </div>
    </div>

    <MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6" Color="Color.Primary">
        <!-- Draw Features -->
        <MudTabPanel Icon="@Icons.Material.Filled.Draw" Text="Draw">
            <MudGrid>
                <MudItem xs="12" md="9">
                    <div style="height: 600px;">
                        <HonuaMap Id="editor-draw-map"
                                  MapStyle="https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json"
                                  Center="new[] { -122.4194, 37.7749 }"
                                  Zoom="13"
                                  Style="width: 100%; height: 100%; border-radius: 8px;" />

                        <HonuaEditor Id="draw-editor"
                                     SyncWith="editor-draw-map"
                                     AllowDraw="true"
                                     AllowEdit="false"
                                     DrawMode="DrawMode.Point"
                                     Style="width: 100%; height: 100%;" />
                    </div>
                </MudItem>
                <MudItem xs="12" md="3">
                    <div class="component-panel">
                        <div class="panel-header">
                            <h3 class="panel-title">Drawing Tools</h3>
                        </div>
                        <MudStack Spacing="2">
                            <MudButton Variant="Variant.Outlined" Color="Color.Primary" FullWidth="true" StartIcon="@Icons.Material.Filled.Place">
                                Draw Point
                            </MudButton>
                            <MudButton Variant="Variant.Outlined" Color="Color.Primary" FullWidth="true" StartIcon="@Icons.Material.Filled.Timeline">
                                Draw Line
                            </MudButton>
                            <MudButton Variant="Variant.Outlined" Color="Color.Primary" FullWidth="true" StartIcon="@Icons.Material.Filled.CropSquare">
                                Draw Polygon
                            </MudButton>
                            <MudButton Variant="Variant.Outlined" Color="Color.Primary" FullWidth="true" StartIcon="@Icons.Material.Filled.Circle">
                                Draw Circle
                            </MudButton>
                            <MudDivider />
                            <MudButton Variant="Variant.Filled" Color="Color.Success" FullWidth="true" StartIcon="@Icons.Material.Filled.Save">
                                Save
                            </MudButton>
                            <MudButton Variant="Variant.Outlined" Color="Color.Error" FullWidth="true" StartIcon="@Icons.Material.Filled.Cancel">
                                Cancel
                            </MudButton>
                        </MudStack>

                        <MudDivider Class="my-4" />

                        <MudText Typo="Typo.subtitle2" Class="mb-2">Instructions</MudText>
                        <MudList Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.Check" IconSize="Size.Small">
                                Select a drawing tool
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.Check" IconSize="Size.Small">
                                Click on map to add points
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.Check" IconSize="Size.Small">
                                Double-click to finish
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.Check" IconSize="Size.Small">
                                Press Escape to cancel
                            </MudListItem>
                        </MudList>
                    </div>
                </MudItem>
            </MudGrid>

            <div class="code-example mt-4">
                <pre><code>&lt;HonuaEditor Id="editor"
             SyncWith="my-map"
             AllowDraw="true"
             DrawMode="DrawMode.Polygon"
             OnFeatureDrawn="HandleFeatureDrawn" /&gt;</code></pre>
            </div>
        </MudTabPanel>

        <!-- Edit Features -->
        <MudTabPanel Icon="@Icons.Material.Filled.EditLocation" Text="Edit">
            <MudGrid>
                <MudItem xs="12" md="9">
                    <div style="height: 600px;">
                        <HonuaMap Id="editor-edit-map"
                                  MapStyle="https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json"
                                  Center="new[] { -122.4194, 37.7749 }"
                                  Zoom="13"
                                  Style="width: 100%; height: 100%; border-radius: 8px;" />

                        <HonuaEditor Id="edit-editor"
                                     SyncWith="editor-edit-map"
                                     AllowDraw="false"
                                     AllowEdit="true"
                                     AllowDelete="true"
                                     ShowEditHandles="true"
                                     Style="width: 100%; height: 100%;" />
                    </div>
                </MudItem>
                <MudItem xs="12" md="3">
                    <div class="component-panel">
                        <div class="panel-header">
                            <h3 class="panel-title">Edit Tools</h3>
                        </div>
                        <MudStack Spacing="2">
                            <MudButton Variant="Variant.Outlined" Color="Color.Primary" FullWidth="true" StartIcon="@Icons.Material.Filled.Edit">
                                Edit Geometry
                            </MudButton>
                            <MudButton Variant="Variant.Outlined" Color="Color.Primary" FullWidth="true" StartIcon="@Icons.Material.Filled.OpenWith">
                                Move Feature
                            </MudButton>
                            <MudButton Variant="Variant.Outlined" Color="Color.Warning" FullWidth="true" StartIcon="@Icons.Material.Filled.Delete">
                                Delete Feature
                            </MudButton>
                            <MudDivider />
                            <MudButton Variant="Variant.Text" Color="Color.Default" FullWidth="true" StartIcon="@Icons.Material.Filled.Undo">
                                Undo
                            </MudButton>
                            <MudButton Variant="Variant.Text" Color="Color.Default" FullWidth="true" StartIcon="@Icons.Material.Filled.Redo">
                                Redo
                            </MudButton>
                        </MudStack>

                        <MudDivider Class="my-4" />

                        <MudText Typo="Typo.subtitle2" Class="mb-2">Edit Modes</MudText>
                        <MudList Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.GpsFixed" IconSize="Size.Small">
                                <strong>Vertex Edit:</strong> Drag handles to move vertices
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.DragIndicator" IconSize="Size.Small">
                                <strong>Move:</strong> Drag feature to new location
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.Delete" IconSize="Size.Small">
                                <strong>Delete:</strong> Click vertex handle + Delete key
                            </MudListItem>
                        </MudList>
                    </div>
                </MudItem>
            </MudGrid>

            <MudAlert Severity="Severity.Info" Class="mt-4">
                <strong>Tip:</strong> Click on a feature to select it for editing. Use the handles to modify geometry.
            </MudAlert>
        </MudTabPanel>

        <!-- Attribute Editing -->
        <MudTabPanel Icon="@Icons.Material.Filled.Assignment" Text="Attributes">
            <MudGrid>
                <MudItem xs="12" md="9">
                    <div style="height: 600px;">
                        <HonuaMap Id="editor-attr-map"
                                  MapStyle="https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json"
                                  Center="new[] { -122.4194, 37.7749 }"
                                  Zoom="13"
                                  Style="width: 100%; height: 100%; border-radius: 8px;" />

                        <HonuaEditor Id="attr-editor"
                                     SyncWith="editor-attr-map"
                                     AllowDraw="true"
                                     AllowEdit="true"
                                     ShowAttributeEditor="true"
                                     Style="width: 100%; height: 100%;" />
                    </div>
                </MudItem>
                <MudItem xs="12" md="3">
                    <div class="component-panel" style="max-height: 600px; overflow-y: auto;">
                        <div class="panel-header">
                            <h3 class="panel-title">Attributes</h3>
                        </div>
                        <MudPaper Class="pa-3" Elevation="0">
                            <MudTextField Label="Name" Variant="Variant.Outlined" Margin="Margin.Dense" FullWidth="true" />
                            <MudTextField Label="Description" Variant="Variant.Outlined" Margin="Margin.Dense" Lines="3" FullWidth="true" />
                            <MudSelect Label="Category" Variant="Variant.Outlined" Margin="Margin.Dense" FullWidth="true">
                                <MudSelectItem Value="@("Park")">Park</MudSelectItem>
                                <MudSelectItem Value="@("Building")">Building</MudSelectItem>
                                <MudSelectItem Value="@("Road")">Road</MudSelectItem>
                                <MudSelectItem Value="@("Water")">Water</MudSelectItem>
                            </MudSelect>
                            <MudTextField Label="Area (sqm)" Variant="Variant.Outlined" Margin="Margin.Dense" InputType="InputType.Number" FullWidth="true" />
                            <MudDatePicker Label="Date Created" Variant="Variant.Outlined" Margin="Margin.Dense" />
                            <MudSwitch Label="Active" Color="Color.Primary" Class="mt-2" />
                        </MudPaper>

                        <MudDivider Class="my-3" />

                        <MudText Typo="Typo.subtitle2" Class="mb-2">Custom Fields</MudText>
                        <MudStack Spacing="2">
                            <MudButton Variant="Variant.Text" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" Size="Size.Small">
                                Add Field
                            </MudButton>
                        </MudStack>
                    </div>
                </MudItem>
            </MudGrid>

            <div class="code-example mt-4">
                <pre><code>// Define attribute schema
var schema = new AttributeSchema
{
    Fields = new[]
    {
        new Field { Name = "name", Type = "string", Required = true },
        new Field { Name = "category", Type = "select", Options = new[] { "Park", "Building" } },
        new Field { Name = "area", Type = "number" }
    }
};

&lt;HonuaEditor SyncWith="my-map"
             ShowAttributeEditor="true"
             AttributeSchema="schema" /&gt;</code></pre>
            </div>
        </MudTabPanel>

        <!-- Workflow -->
        <MudTabPanel Icon="@Icons.Material.Filled.AccountTree" Text="Workflow">
            <MudText Typo="Typo.h6" Class="mb-3">Edit Workflow</MudText>
            <MudText Typo="Typo.body1" Class="mb-4">
                Complete workflow with save, cancel, validation, and change tracking.
            </MudText>

            <MudStepper @ref="_stepper" Color="Color.Primary" Variant="Variant.Filled">
                <ChildContent>
                    <MudStep Title="Start Edit Session">
                        <MudText Class="mb-4">Begin editing by selecting a feature or starting to draw.</MudText>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@(() => _stepper?.NextStep())">
                            Start Editing
                        </MudButton>
                    </MudStep>
                    <MudStep Title="Make Changes">
                        <MudText Class="mb-4">Modify geometry and attributes as needed.</MudText>
                        <MudAlert Severity="Severity.Info" Class="mb-2">Changes are tracked in memory until saved.</MudAlert>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@(() => _stepper?.NextStep())">
                            Continue
                        </MudButton>
                    </MudStep>
                    <MudStep Title="Validate">
                        <MudText Class="mb-4">Validate changes against schema and business rules.</MudText>
                        <MudList Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                Geometry is valid
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                All required fields filled
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                No topology errors
                            </MudListItem>
                        </MudList>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@(() => _stepper?.NextStep())" Class="mt-2">
                            Validate
                        </MudButton>
                    </MudStep>
                    <MudStep Title="Save or Cancel">
                        <MudText Class="mb-4">Commit changes to database or discard.</MudText>
                        <MudStack Row="true" Spacing="2">
                            <MudButton Variant="Variant.Filled" Color="Color.Success" StartIcon="@Icons.Material.Filled.Save">
                                Save Changes
                            </MudButton>
                            <MudButton Variant="Variant.Outlined" Color="Color.Error" StartIcon="@Icons.Material.Filled.Cancel">
                                Cancel
                            </MudButton>
                        </MudStack>
                    </MudStep>
                </ChildContent>
            </MudStepper>

            <MudDivider Class="my-4" />

            <MudText Typo="Typo.h6" Class="mb-3">Change Tracking</MudText>
            <MudGrid>
                <MudItem xs="12" md="6">
                    <MudPaper Class="pa-3" Elevation="2">
                        <MudText Typo="Typo.subtitle1" Class="mb-2">Undo Stack (5 actions)</MudText>
                        <MudList Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.Edit">
                                Modified "Building A" geometry
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.Add">
                                Added new point feature
                            </MudListItem>
                            <MudListItem Icon="@Icons.Material.Filled.Delete">
                                Deleted "Old Road"
                            </MudListItem>
                        </MudList>
                    </MudPaper>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudPaper Class="pa-3" Elevation="2">
                        <MudText Typo="Typo.subtitle1" Class="mb-2">Redo Stack (2 actions)</MudText>
                        <MudList Dense="true">
                            <MudListItem Icon="@Icons.Material.Filled.Undo" IconColor="Color.Secondary">
                                Undo delete "Old Road"
                            </MudListItem>
                        </MudList>
                    </MudPaper>
                </MudItem>
            </MudGrid>
        </MudTabPanel>

        <!-- API Reference -->
        <MudTabPanel Icon="@Icons.Material.Filled.Code" Text="API">
            <MudText Typo="Typo.h6" Class="mb-3">Component Properties</MudText>
            <MudSimpleTable Elevation="0" Dense="true">
                <thead>
                    <tr>
                        <th>Property</th>
                        <th>Type</th>
                        <th>Default</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>SyncWith</code></td>
                        <td>string</td>
                        <td>-</td>
                        <td>Map ID to synchronize with</td>
                    </tr>
                    <tr>
                        <td><code>AllowDraw</code></td>
                        <td>bool</td>
                        <td>true</td>
                        <td>Enable drawing new features</td>
                    </tr>
                    <tr>
                        <td><code>AllowEdit</code></td>
                        <td>bool</td>
                        <td>true</td>
                        <td>Enable editing existing features</td>
                    </tr>
                    <tr>
                        <td><code>AllowDelete</code></td>
                        <td>bool</td>
                        <td>true</td>
                        <td>Enable deleting features</td>
                    </tr>
                    <tr>
                        <td><code>DrawMode</code></td>
                        <td>DrawMode</td>
                        <td>Point</td>
                        <td>Point, Line, Polygon, Circle, Rectangle</td>
                    </tr>
                    <tr>
                        <td><code>ShowEditHandles</code></td>
                        <td>bool</td>
                        <td>true</td>
                        <td>Show vertex edit handles</td>
                    </tr>
                    <tr>
                        <td><code>ShowAttributeEditor</code></td>
                        <td>bool</td>
                        <td>false</td>
                        <td>Show attribute editing panel</td>
                    </tr>
                    <tr>
                        <td><code>EnableUndo</code></td>
                        <td>bool</td>
                        <td>true</td>
                        <td>Enable undo/redo functionality</td>
                    </tr>
                </tbody>
            </MudSimpleTable>

            <MudText Typo="Typo.h6" Class="mt-4 mb-3">Events</MudText>
            <MudSimpleTable Elevation="0" Dense="true">
                <thead>
                    <tr>
                        <th>Event</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>OnFeatureDrawn</code></td>
                        <td>EventCallback&lt;Feature&gt;</td>
                        <td>Fired when new feature drawn</td>
                    </tr>
                    <tr>
                        <td><code>OnFeatureEdited</code></td>
                        <td>EventCallback&lt;Feature&gt;</td>
                        <td>Fired when feature modified</td>
                    </tr>
                    <tr>
                        <td><code>OnFeatureDeleted</code></td>
                        <td>EventCallback&lt;string&gt;</td>
                        <td>Fired when feature deleted</td>
                    </tr>
                    <tr>
                        <td><code>OnSave</code></td>
                        <td>EventCallback&lt;ChangeSet&gt;</td>
                        <td>Fired when save button clicked</td>
                    </tr>
                    <tr>
                        <td><code>OnCancel</code></td>
                        <td>EventCallback</td>
                        <td>Fired when cancel button clicked</td>
                    </tr>
                </tbody>
            </MudSimpleTable>
        </MudTabPanel>
    </MudTabs>
</div>

@code {
    private MudStepper? _stepper;
}
