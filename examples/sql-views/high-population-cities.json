{
  "catalog": {
    "id": "sql-views-demo",
    "title": "SQL Views Demo Catalog",
    "description": "Demonstrates SQL Views (Virtual Layers) feature",
    "version": "1.0.0"
  },
  "folders": [
    {
      "id": "demo",
      "title": "Demo Layers"
    }
  ],
  "dataSources": [
    {
      "id": "demo_postgis",
      "provider": "postgis",
      "connectionString": "Host=localhost;Port=5432;Database=geodemo;Username=postgres;Password=postgres"
    }
  ],
  "services": [
    {
      "id": "demo",
      "title": "Demo Service",
      "folderId": "demo",
      "serviceType": "wfs",
      "dataSourceId": "demo_postgis",
      "description": "Demonstration service with SQL view layers",
      "ogc": {
        "collectionsEnabled": true,
        "wfsEnabled": true,
        "defaultCrs": "http://www.opengis.net/def/crs/EPSG/0/4326"
      }
    }
  ],
  "layers": [
    {
      "id": "high_population_cities",
      "serviceId": "demo",
      "title": "High Population Cities",
      "description": "Cities filtered by minimum population and region using SQL view parameters",
      "geometryType": "Point",
      "idField": "city_id",
      "geometryField": "location",
      "displayField": "name",
      "crs": [
        "http://www.opengis.net/def/crs/EPSG/0/4326",
        "http://www.opengis.net/def/crs/EPSG/0/3857"
      ],
      "sqlView": {
        "sql": "SELECT city_id, name, population, region, country, location FROM cities WHERE population > :min_population AND region = :region ORDER BY population DESC",
        "description": "Dynamically filters cities by population threshold and region",
        "parameters": [
          {
            "name": "min_population",
            "title": "Minimum Population",
            "description": "Filter cities with population greater than this value",
            "type": "integer",
            "defaultValue": "100000",
            "required": false,
            "validation": {
              "min": 0,
              "max": 100000000,
              "errorMessage": "Population must be between 0 and 100 million"
            }
          },
          {
            "name": "region",
            "title": "Region",
            "description": "Geographic region to filter by",
            "type": "string",
            "defaultValue": "west",
            "required": true,
            "validation": {
              "allowedValues": [
                "north",
                "south",
                "east",
                "west",
                "central"
              ],
              "errorMessage": "Region must be one of: north, south, east, west, central"
            }
          }
        ],
        "timeoutSeconds": 30,
        "readOnly": true
      },
      "fields": [
        {
          "name": "city_id",
          "alias": "City ID",
          "dataType": "esriFieldTypeInteger",
          "nullable": false,
          "editable": false
        },
        {
          "name": "name",
          "alias": "City Name",
          "dataType": "esriFieldTypeString",
          "maxLength": 255,
          "nullable": false
        },
        {
          "name": "population",
          "alias": "Population",
          "dataType": "esriFieldTypeInteger",
          "nullable": true
        },
        {
          "name": "region",
          "alias": "Region",
          "dataType": "esriFieldTypeString",
          "maxLength": 50,
          "nullable": true
        },
        {
          "name": "country",
          "alias": "Country",
          "dataType": "esriFieldTypeString",
          "maxLength": 100,
          "nullable": true
        },
        {
          "name": "location",
          "alias": "Location",
          "dataType": "esriFieldTypeGeometry",
          "nullable": false
        }
      ]
    },
    {
      "id": "city_statistics",
      "serviceId": "demo",
      "title": "City Statistics by Country",
      "description": "Aggregated city statistics using SQL view with JOIN",
      "geometryType": "Point",
      "idField": "country_code",
      "geometryField": "centroid",
      "displayField": "country_name",
      "crs": [
        "http://www.opengis.net/def/crs/EPSG/0/4326"
      ],
      "sqlView": {
        "sql": "SELECT c.country_code, c.country_name, c.centroid, COUNT(ci.city_id) as city_count, SUM(ci.population) as total_population, AVG(ci.population) as avg_population FROM countries c LEFT JOIN cities ci ON c.country_code = ci.country_code WHERE c.continent = :continent GROUP BY c.country_code, c.country_name, c.centroid HAVING COUNT(ci.city_id) >= :min_cities",
        "description": "Country-level statistics with city aggregations",
        "parameters": [
          {
            "name": "continent",
            "title": "Continent",
            "description": "Filter countries by continent",
            "type": "string",
            "defaultValue": "North America",
            "validation": {
              "allowedValues": [
                "Africa",
                "Antarctica",
                "Asia",
                "Europe",
                "North America",
                "Oceania",
                "South America"
              ]
            }
          },
          {
            "name": "min_cities",
            "title": "Minimum Number of Cities",
            "description": "Only show countries with at least this many cities",
            "type": "integer",
            "defaultValue": "1",
            "validation": {
              "min": 1,
              "max": 10000
            }
          }
        ],
        "timeoutSeconds": 60,
        "readOnly": true
      },
      "fields": [
        {
          "name": "country_code",
          "alias": "Country Code",
          "dataType": "esriFieldTypeString",
          "maxLength": 3,
          "nullable": false,
          "editable": false
        },
        {
          "name": "country_name",
          "alias": "Country",
          "dataType": "esriFieldTypeString",
          "maxLength": 255,
          "nullable": false
        },
        {
          "name": "city_count",
          "alias": "Number of Cities",
          "dataType": "esriFieldTypeInteger",
          "nullable": true
        },
        {
          "name": "total_population",
          "alias": "Total Population",
          "dataType": "esriFieldTypeBigInteger",
          "nullable": true
        },
        {
          "name": "avg_population",
          "alias": "Average City Population",
          "dataType": "esriFieldTypeDouble",
          "nullable": true
        },
        {
          "name": "centroid",
          "alias": "Centroid",
          "dataType": "esriFieldTypeGeometry",
          "nullable": false
        }
      ]
    },
    {
      "id": "temporal_events",
      "serviceId": "demo",
      "title": "Temporal Events",
      "description": "Events filtered by date range using SQL view",
      "geometryType": "Point",
      "idField": "event_id",
      "geometryField": "location",
      "displayField": "event_name",
      "crs": [
        "http://www.opengis.net/def/crs/EPSG/0/4326"
      ],
      "sqlView": {
        "sql": "SELECT event_id, event_name, event_type, event_date, location FROM events WHERE event_date >= :start_date AND event_date <= :end_date AND event_type = :event_type",
        "description": "Filter events by date range and type",
        "parameters": [
          {
            "name": "start_date",
            "title": "Start Date",
            "description": "Beginning of date range (ISO 8601 format)",
            "type": "date",
            "defaultValue": "2024-01-01",
            "required": true
          },
          {
            "name": "end_date",
            "title": "End Date",
            "description": "End of date range (ISO 8601 format)",
            "type": "date",
            "defaultValue": "2024-12-31",
            "required": true
          },
          {
            "name": "event_type",
            "title": "Event Type",
            "description": "Type of event to filter",
            "type": "string",
            "defaultValue": "conference",
            "validation": {
              "allowedValues": [
                "conference",
                "workshop",
                "seminar",
                "meetup",
                "webinar"
              ]
            }
          }
        ],
        "securityFilter": "deleted_at IS NULL AND published = true",
        "timeoutSeconds": 30,
        "readOnly": true
      },
      "fields": [
        {
          "name": "event_id",
          "alias": "Event ID",
          "dataType": "esriFieldTypeInteger",
          "nullable": false,
          "editable": false
        },
        {
          "name": "event_name",
          "alias": "Event Name",
          "dataType": "esriFieldTypeString",
          "maxLength": 255,
          "nullable": false
        },
        {
          "name": "event_type",
          "alias": "Event Type",
          "dataType": "esriFieldTypeString",
          "maxLength": 50,
          "nullable": true
        },
        {
          "name": "event_date",
          "alias": "Event Date",
          "dataType": "esriFieldTypeDate",
          "nullable": true
        },
        {
          "name": "location",
          "alias": "Location",
          "dataType": "esriFieldTypeGeometry",
          "nullable": false
        }
      ]
    }
  ]
}
