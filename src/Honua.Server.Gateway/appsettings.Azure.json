{
  "ServiceName": "honua-gateway",
  "ServiceVersion": "1.0.0",

  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Yarp": "Information"
    }
  },

  "Serilog": {
    "MinimumLevel": {
      "Default": "Information"
    }
  },

  "AllowedHosts": "*",

  "OpenTelemetry": {
    "OtlpEndpoint": ""
  },

  "Redis": {
    "ConnectionString": ""
  },

  "BackendServices": {
    "odata": "dapr://odata-api",
    "raster": "dapr://raster-api",
    "vector": "dapr://vector-api",
    "stac": "dapr://stac-api",
    "api": "dapr://core-api"
  },

  "RateLimiting": {
    "GlobalPermitLimit": 5000,
    "GlobalWindowSeconds": 60,
    "PerIpPermitLimit": 100,
    "PerIpWindowSeconds": 60
  },

  "Cors": {
    "AllowedOrigins": []
  },

  "ReverseProxy": {
    "Routes": {
      "tenant-odata-route": {
        "ClusterId": "odata-cluster",
        "Match": {
          "Hosts": ["{tenant}.honua.io"],
          "Path": "/odata/{**catch-all}"
        },
        "Transforms": [
          {
            "RequestHeader": "X-Tenant-Id",
            "Set": "{tenant}"
          },
          {
            "PathRemovePrefix": "/odata"
          }
        ],
        "RateLimiterPolicy": "per-ip",
        "Order": 1
      },
      "tenant-raster-route": {
        "ClusterId": "raster-cluster",
        "Match": {
          "Hosts": ["{tenant}.honua.io"],
          "Path": "/raster/{**catch-all}"
        },
        "Transforms": [
          {
            "RequestHeader": "X-Tenant-Id",
            "Set": "{tenant}"
          },
          {
            "PathRemovePrefix": "/raster"
          }
        ],
        "RateLimiterPolicy": "per-ip",
        "Order": 2
      },
      "tenant-vector-route": {
        "ClusterId": "vector-cluster",
        "Match": {
          "Hosts": ["{tenant}.honua.io"],
          "Path": "/vector/{**catch-all}"
        },
        "Transforms": [
          {
            "RequestHeader": "X-Tenant-Id",
            "Set": "{tenant}"
          },
          {
            "PathRemovePrefix": "/vector"
          }
        ],
        "RateLimiterPolicy": "per-ip",
        "Order": 3
      },
      "tenant-stac-route": {
        "ClusterId": "stac-cluster",
        "Match": {
          "Hosts": ["{tenant}.honua.io"],
          "Path": "/stac/{**catch-all}"
        },
        "Transforms": [
          {
            "RequestHeader": "X-Tenant-Id",
            "Set": "{tenant}"
          },
          {
            "PathRemovePrefix": "/stac"
          }
        ],
        "RateLimiterPolicy": "per-ip",
        "Order": 4
      },
      "tenant-api-route": {
        "ClusterId": "api-cluster",
        "Match": {
          "Hosts": ["{tenant}.honua.io"],
          "Path": "/api/{**catch-all}"
        },
        "Transforms": [
          {
            "RequestHeader": "X-Tenant-Id",
            "Set": "{tenant}"
          },
          {
            "PathRemovePrefix": "/api"
          }
        ],
        "RateLimiterPolicy": "per-ip",
        "Order": 5
      },
      "tenant-root-route": {
        "ClusterId": "api-cluster",
        "Match": {
          "Hosts": ["{tenant}.honua.io"],
          "Path": "/{**catch-all}"
        },
        "Transforms": [
          {
            "RequestHeader": "X-Tenant-Id",
            "Set": "{tenant}"
          }
        ],
        "RateLimiterPolicy": "per-ip",
        "Order": 100
      }
    },

    "Clusters": {
      "odata-cluster": {
        "Destinations": {
          "odata-dapr": {
            "Address": "http://localhost:3500/v1.0/invoke/odata-api/method"
          }
        },
        "HttpRequest": {
          "Timeout": "00:10:00"
        },
        "Metadata": {
          "Dapr.AppId": "odata-api"
        }
      },

      "raster-cluster": {
        "Destinations": {
          "raster-dapr": {
            "Address": "http://localhost:3500/v1.0/invoke/raster-api/method"
          }
        },
        "HttpRequest": {
          "Timeout": "00:20:00"
        },
        "Metadata": {
          "Dapr.AppId": "raster-api"
        }
      },

      "vector-cluster": {
        "Destinations": {
          "vector-dapr": {
            "Address": "http://localhost:3500/v1.0/invoke/vector-api/method"
          }
        },
        "HttpRequest": {
          "Timeout": "00:05:00"
        },
        "Metadata": {
          "Dapr.AppId": "vector-api"
        }
      },

      "stac-cluster": {
        "Destinations": {
          "stac-dapr": {
            "Address": "http://localhost:3500/v1.0/invoke/stac-api/method"
          }
        },
        "HttpRequest": {
          "Timeout": "00:10:00"
        },
        "Metadata": {
          "Dapr.AppId": "stac-api"
        }
      },

      "api-cluster": {
        "Destinations": {
          "api-dapr": {
            "Address": "http://localhost:3500/v1.0/invoke/core-api/method"
          }
        },
        "HttpRequest": {
          "Timeout": "00:10:00"
        },
        "Metadata": {
          "Dapr.AppId": "core-api"
        }
      }
    }
  }
}
