{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Honua Server Configuration Schema",
  "description": "JSON Schema for Honua Server appsettings.json configuration file",
  "type": "object",
  "properties": {
    "ConnectionStrings": {
      "type": "object",
      "description": "Database and cache connection strings",
      "properties": {
        "Redis": {
          "type": "string",
          "description": "Redis connection string for caching and distributed locking. Format: host:port,option=value",
          "examples": ["localhost:6379,abortConnect=false,connectTimeout=5000"]
        }
      }
    },
    "Serilog": {
      "type": "object",
      "description": "Serilog logging configuration. See https://github.com/serilog/serilog-settings-configuration",
      "properties": {
        "MinimumLevel": {
          "type": "object",
          "properties": {
            "Default": {
              "type": "string",
              "enum": ["Verbose", "Debug", "Information", "Warning", "Error", "Fatal"],
              "default": "Information"
            }
          }
        }
      }
    },
    "TokenRevocation": {
      "type": "object",
      "description": "JWT token revocation service configuration",
      "properties": {
        "CleanupInterval": {
          "type": "string",
          "description": "Interval for cleaning up expired revoked tokens (TimeSpan format)",
          "pattern": "^\\d{2}:\\d{2}:\\d{2}$",
          "default": "01:00:00",
          "examples": ["01:00:00", "00:30:00"]
        },
        "EnableAutoCleanup": {
          "type": "boolean",
          "description": "Enable automatic cleanup of expired revoked tokens",
          "default": true
        },
        "FailClosedOnRedisError": {
          "type": "boolean",
          "description": "If true, deny all requests when Redis is unavailable (fail-secure). If false, allow requests (fail-open)",
          "default": true
        }
      }
    },
    "Resilience": {
      "type": "object",
      "description": "Resilience patterns configuration (hedging, retry, circuit breaker)",
      "properties": {
        "Hedging": {
          "type": "object",
          "description": "Hedging policy for parallel request execution",
          "properties": {
            "Enabled": {
              "type": "boolean",
              "description": "Enable hedging for supported operations",
              "default": true
            },
            "MaxHedgedAttempts": {
              "type": "integer",
              "description": "Maximum number of hedged attempts",
              "minimum": 1,
              "maximum": 5,
              "default": 2
            },
            "DelayMilliseconds": {
              "type": "integer",
              "description": "Delay in milliseconds before starting hedged attempts",
              "minimum": 10,
              "maximum": 1000,
              "default": 50
            },
            "TimeoutSeconds": {
              "type": "integer",
              "description": "Timeout in seconds for hedged operations",
              "minimum": 1,
              "maximum": 60,
              "default": 5
            }
          }
        }
      }
    },
    "honua": {
      "type": "object",
      "description": "Honua server-specific configuration",
      "properties": {
        "pagination": {
          "type": "object",
          "description": "Pagination limits for various API endpoints",
          "properties": {
            "defaultLimit": {
              "type": "integer",
              "description": "Default number of items per page",
              "minimum": 1,
              "maximum": 1000,
              "default": 10
            },
            "maxLimit": {
              "type": "integer",
              "description": "Maximum number of items per page",
              "minimum": 1,
              "maximum": 10000,
              "default": 1000
            },
            "stacCollectionDefaultLimit": {
              "type": "integer",
              "description": "Default limit for STAC collection listings",
              "minimum": 1,
              "maximum": 1000,
              "default": 10
            },
            "stacCollectionMaxLimit": {
              "type": "integer",
              "description": "Maximum limit for STAC collection listings",
              "minimum": 1,
              "maximum": 10000,
              "default": 1000
            },
            "stacItemDefaultLimit": {
              "type": "integer",
              "description": "Default limit for STAC item listings",
              "minimum": 1,
              "maximum": 1000,
              "default": 10
            },
            "stacItemMaxLimit": {
              "type": "integer",
              "description": "Maximum limit for STAC item listings",
              "minimum": 1,
              "maximum": 10000,
              "default": 1000
            }
          }
        },
        "authentication": {
          "type": "object",
          "description": "Authentication and authorization configuration",
          "properties": {
            "mode": {
              "type": "string",
              "description": "Authentication mode",
              "enum": ["Local", "OAuth2", "OIDC", "SAML", "ApiKey"],
              "default": "Local"
            },
            "enforce": {
              "type": "boolean",
              "description": "Enforce authentication for all requests",
              "default": true
            },
            "quickStart": {
              "type": "object",
              "description": "Quick start mode for development (insecure - do not use in production)",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable quick start mode (WARNING: disables authentication)",
                  "default": false
                }
              }
            },
            "jwt": {
              "type": "object",
              "description": "JWT token configuration",
              "properties": {
                "issuer": {
                  "type": "string",
                  "description": "JWT issuer claim"
                },
                "audience": {
                  "type": "string",
                  "description": "JWT audience claim"
                },
                "secretKey": {
                  "type": "string",
                  "description": "JWT signing secret (use environment variable in production)"
                },
                "expirationMinutes": {
                  "type": "integer",
                  "description": "JWT expiration time in minutes",
                  "minimum": 1,
                  "maximum": 43200,
                  "default": 60
                }
              }
            }
          }
        },
        "security": {
          "type": "object",
          "description": "Security configuration (headers, CORS, rate limiting)",
          "properties": {
            "headers": {
              "type": "object",
              "description": "Security headers configuration",
              "properties": {
                "enableHsts": {
                  "type": "boolean",
                  "description": "Enable HTTP Strict Transport Security",
                  "default": true
                },
                "hstsMaxAge": {
                  "type": "integer",
                  "description": "HSTS max-age in seconds",
                  "default": 31536000
                },
                "enableCsp": {
                  "type": "boolean",
                  "description": "Enable Content Security Policy",
                  "default": true
                },
                "cspPolicy": {
                  "type": "string",
                  "description": "Content Security Policy directive",
                  "default": "default-src 'self'"
                }
              }
            },
            "cors": {
              "type": "object",
              "description": "Cross-Origin Resource Sharing configuration",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable CORS",
                  "default": true
                },
                "allowedOrigins": {
                  "type": "array",
                  "description": "List of allowed origins (* for all, not recommended in production)",
                  "items": {
                    "type": "string"
                  },
                  "default": ["*"]
                }
              }
            },
            "rateLimiting": {
              "type": "object",
              "description": "Rate limiting configuration",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable rate limiting",
                  "default": true
                },
                "requestsPerMinute": {
                  "type": "integer",
                  "description": "Maximum requests per minute per IP",
                  "minimum": 1,
                  "maximum": 10000,
                  "default": 100
                }
              }
            }
          }
        },
        "odata": {
          "type": "object",
          "description": "OData API configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable OData endpoints",
              "default": true
            },
            "allowWrites": {
              "type": "boolean",
              "description": "Allow write operations via OData",
              "default": false
            },
            "defaultPageSize": {
              "type": "integer",
              "description": "Default page size for OData queries",
              "minimum": 1,
              "maximum": 1000,
              "default": 100
            },
            "maxPageSize": {
              "type": "integer",
              "description": "Maximum page size for OData queries",
              "minimum": 1,
              "maximum": 10000,
              "default": 1000
            }
          }
        },
        "zarr": {
          "type": "object",
          "description": "Zarr raster time-series configuration",
          "properties": {
            "timeSeries": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable Zarr time-series support",
                  "default": true
                },
                "pythonExecutable": {
                  "type": "string",
                  "description": "Path to Python executable for Zarr conversion (requires xarray, zarr packages)"
                },
                "cacheDirectory": {
                  "type": "string",
                  "description": "Directory for Zarr cache files"
                }
              }
            }
          }
        },
        "gitops": {
          "type": "object",
          "description": "GitOps configuration management",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable GitOps reconciliation",
              "default": false
            },
            "repositoryUrl": {
              "type": "string",
              "description": "Git repository URL for configuration"
            },
            "branch": {
              "type": "string",
              "description": "Git branch to track",
              "default": "main"
            },
            "reconcileIntervalSeconds": {
              "type": "integer",
              "description": "Interval in seconds for checking configuration drift",
              "minimum": 10,
              "maximum": 3600,
              "default": 60
            }
          }
        },
        "observability": {
          "type": "object",
          "description": "Observability configuration (metrics, tracing, logging)",
          "properties": {
            "metrics": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable metrics collection",
                  "default": true
                },
                "endpoint": {
                  "type": "string",
                  "description": "Metrics endpoint path",
                  "default": "/metrics"
                },
                "usePrometheus": {
                  "type": "boolean",
                  "description": "Use Prometheus format for metrics",
                  "default": true
                }
              }
            },
            "tracing": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable distributed tracing",
                  "default": false
                },
                "endpoint": {
                  "type": "string",
                  "description": "OpenTelemetry collector endpoint"
                },
                "samplingRate": {
                  "type": "number",
                  "description": "Trace sampling rate (0.0 to 1.0)",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "default": 0.1
                }
              }
            }
          }
        }
      }
    }
  }
}
