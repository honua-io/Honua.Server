{
  "$schema": "https://json.schemastore.org/appsettings.json",

  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Microsoft.AspNetCore.Hosting.Diagnostics": "Information",
      "Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware": "Error",
      "System.Net.Http.HttpClient": "Warning",
      "Honua": "Information"
    }
  },

  "AllowedHosts": "",
  "_AllowedHostsNote": "REQUIRED: Set to actual domain(s), comma-separated. Example: yourdomain.com,*.yourdomain.com",

  "ConnectionStrings": {
    "Redis": "",
    "_RedisNote": "REQUIRED: Set to production Redis instance. Example: server:6379,password=secret,abortConnect=false,connectTimeout=5000"
  },

  "honua": {
    "metadata": {
      "provider": "",
      "path": "",
      "_providerNote": "REQUIRED: json, postgres, or s3",
      "_pathNote": "REQUIRED: Path to metadata file or connection string. For json: ./metadata/production-metadata.json"
    },

    "cors": {
      "allowAnyOrigin": false,
      "allowCredentials": true,
      "allowedOrigins": [],
      "_allowedOriginsNote": "REQUIRED: List of allowed frontend domains. Example: [\"https://app.yourdomain.com\", \"https://www.yourdomain.com\"]",
      "_securityNote": "allowAnyOrigin MUST be false in production"
    },

    "authentication": {
      "mode": "Local",
      "enforce": true,
      "quickStart": {
        "enabled": false
      },
      "local": {
        "enabled": true,
        "sessionLifetime": "08:00:00",
        "requireEmailVerification": false,
        "minPasswordLength": 16,
        "requireUppercase": true,
        "requireLowercase": true,
        "requireDigit": true,
        "requireSpecialCharacter": true,
        "maxFailedAttempts": 5,
        "lockoutDuration": "00:15:00",
        "signingKeyMode": "Persistent"
      },
      "jwt": {
        "issuer": "Honua.Server",
        "audience": "Honua.Clients",
        "expirationMinutes": 60,
        "clockSkewMinutes": 5
      },
      "_authNote": "Disable local auth if using SSO in production"
    },

    "security": {
      "apiKey": {
        "enabled": true
      }
    },

    "odata": {
      "enabled": true,
      "allowWrites": false,
      "defaultPageSize": 100,
      "maxPageSize": 1000,
      "emitWktShadowProperties": true
    }
  },

  "TrustedProxies": [],
  "_TrustedProxiesNote": "REQUIRED if behind load balancer: [\"10.0.0.0/8\", \"172.16.0.0/12\"]",

  "RateLimiting": {
    "Enabled": true,
    "Default": {
      "PermitLimit": 100,
      "WindowMinutes": 1,
      "SegmentsPerWindow": 4,
      "QueueLimit": 10
    },
    "OgcApi": {
      "PermitLimit": 200,
      "WindowMinutes": 1,
      "SegmentsPerWindow": 4,
      "QueueLimit": 20
    },
    "OpenRosa": {
      "PermitLimit": 50,
      "WindowMinutes": 1,
      "SegmentsPerWindow": 4,
      "QueueLimit": 5
    },
    "Geoservices": {
      "PermitLimit": 150,
      "WindowMinutes": 1,
      "SegmentsPerWindow": 4,
      "QueueLimit": 15
    },
    "_rateLimitingNote": "Configure TrustedProxies if rate limiting by IP behind load balancer"
  },

  "RequestLimits": {
    "MaxBodySize": 1073741824
  },

  "Kestrel": {
    "Limits": {
      "MaxRequestBodySize": 104857600,
      "RequestHeadersTimeout": "00:00:30",
      "KeepAliveTimeout": "00:02:00"
    },
    "_kestrelNote": "MaxRequestBodySize: 100MB, adjust based on expected upload sizes"
  },

  "Performance": {
    "_comment": "Performance tuning settings for caching and connection pooling",
    "ResponseCache": {
      "MaxSizeMB": 100
    },
    "MemoryCache": {
      "MaxSizeMB": 200,
      "CompactionPercentage": 0.25,
      "ExpirationScanMinutes": 5
    },
    "_databaseNote": "Database connection pooling is configured via connection strings. Example: Host=localhost;Database=honua;MinPoolSize=2;MaxPoolSize=50;ConnectionLifetime=600"
  },

  "SchemaValidation": {
    "Enabled": true,
    "FailOnError": false,
    "AutoSyncSchema": true
  },

  "observability": {
    "_comment": "=== OBSERVABILITY CONFIGURATION (PRODUCTION) ===",
    "_note_1": "Metrics and request logging are ENABLED by default in production for monitoring",
    "_note_2": "Cloud provider can be 'none' (self-hosted), 'azure', 'aws', or 'gcp'",
    "_note_3": "All settings can be overridden via environment variables (e.g., observability__metrics__enabled=true)",

    "cloudProvider": "none",
    "_cloudProviderComment": "Cloud provider for observability: 'none' (self-hosted Prometheus/Jaeger), 'azure' (Application Insights), 'aws' (CloudWatch/X-Ray), 'gcp' (Cloud Monitoring/Trace)",

    "azure": {
      "connectionString": "",
      "_comment": "Azure Application Insights connection string. Required when cloudProvider='azure'",
      "_format": "InstrumentationKey=xxx;IngestionEndpoint=https://xxx.in.applicationinsights.azure.com/",
      "_environment_override": "Set via APPLICATIONINSIGHTS_CONNECTION_STRING or observability__azure__connectionString"
    },

    "aws": {
      "region": "",
      "otlpEndpoint": "http://localhost:4317",
      "_comment_region": "AWS region for CloudWatch and X-Ray. Required when cloudProvider='aws'. Example: us-east-1, eu-west-1",
      "_comment_otlpEndpoint": "OTLP endpoint for AWS Distro for OpenTelemetry (ADOT) Collector. Default: http://localhost:4317",
      "_credentials_note": "AWS credentials loaded from environment (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY) or IAM role (EC2, ECS, EKS, Lambda)",
      "_deployment_note": "Deploy ADOT Collector as sidecar (ECS) or DaemonSet (EKS) to forward telemetry to CloudWatch/X-Ray",
      "_environment_override": "Set via AWS_REGION or observability__aws__region"
    },

    "gcp": {
      "projectId": "",
      "otlpEndpoint": "http://localhost:4317",
      "_comment_projectId": "GCP project ID for Cloud Monitoring and Cloud Trace. Required when cloudProvider='gcp'. Example: my-project-123456",
      "_comment_otlpEndpoint": "OTLP endpoint for OpenTelemetry Collector that forwards to GCP. Default: http://localhost:4317",
      "_credentials_note": "GCP credentials loaded from GOOGLE_APPLICATION_CREDENTIALS (service account JSON) or GCE metadata (GKE, Cloud Run)",
      "_deployment_note": "Deploy OpenTelemetry Collector with Google Cloud exporter in GKE as DaemonSet or use Google Cloud Operations integration",
      "_permissions_note": "IAM permissions required: monitoring.timeSeries.create, cloudtrace.traces.patch",
      "_environment_override": "Set via GOOGLE_CLOUD_PROJECT or observability__gcp__projectId"
    },

    "logging": {
      "jsonConsole": true,
      "_comment_jsonConsole": "JSON format for production log aggregation (Splunk, ELK, Loki, etc.)",
      "includeScopes": true
    },

    "metrics": {
      "enabled": true,
      "_comment_enabled": "✓ ENABLED: Metrics collection for monitoring",
      "endpoint": "/metrics",
      "_comment_endpoint": "Prometheus scrape endpoint (self-hosted only). Requires authentication (Viewer role or higher)",
      "usePrometheus": true,
      "_comment_usePrometheus": "Prometheus text format export for self-hosted monitoring (Prometheus/Grafana/VictoriaMetrics)",
      "_cloud_export_note": "Cloud provider metrics export is configured via cloudProvider setting above (azure/aws/gcp)",
      "_environment_override": "Set observability__metrics__enabled=false to disable"
    },

    "tracing": {
      "exporter": "otlp",
      "otlpEndpoint": "http://tempo:4317",
      "samplingRatio": 0.1,
      "appInsightsConnectionString": null,
      "_comment": "Distributed tracing for self-hosted backends. For cloud providers, use cloudProvider setting above",
      "_samplingComment": "Sample 10% of requests to prevent overwhelming the tracing backend. Use lower values in high-traffic environments",
      "_comment_exporter": "Exporter type for self-hosted: 'none' (disabled), 'otlp' (Jaeger/Tempo/Grafana Cloud), 'azuremonitor' (legacy), 'console' (debug)",
      "_cloud_tracing_note": "RECOMMENDED: Use cloudProvider='azure/aws/gcp' instead of exporter='azuremonitor' for cloud tracing",
      "_legacy_azure_note": "Legacy Azure support: Set exporter='azuremonitor' and appInsightsConnectionString (deprecated, use cloudProvider='azure')",
      "_example_jaeger": "http://jaeger-collector:4317",
      "_example_tempo": "http://tempo:4317",
      "_example_grafana_cloud": "https://otlp-gateway-prod-us-central-0.grafana.net/otlp with API token",
      "_example_honeycomb": "https://api.honeycomb.io:443 with API key in headers",
      "_example_newrelic": "https://otlp.nr-data.net:4317 with license key",
      "_environment_override": "observability__tracing__exporter=otlp or observability__cloudProvider=azure"
    },

    "requestLogging": {
      "enabled": true,
      "_comment_enabled": "✓ ENABLED: HTTP request/response logging for audit trails and troubleshooting",
      "logHeaders": false,
      "_comment_logHeaders": "Disabled by default (may contain sensitive auth tokens). Enable only for debugging",
      "slowThresholdMs": 5000,
      "_comment_slowThresholdMs": "Log slow requests exceeding 5 seconds for performance monitoring"
    }
  },

  "Serilog": {
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "formatter": "Serilog.Formatting.Compact.CompactJsonFormatter, Serilog.Formatting.Compact"
        }
      },
      {
        "Name": "Seq",
        "Args": {
          "serverUrl": "http://seq:5341",
          "apiKey": "${SEQ_API_KEY}",
          "_comment": "Seq centralized logging. Set SEQ_API_KEY environment variable"
        }
      }
    ],
    "_serilogNote": "Using compact JSON format for log aggregation systems",
    "_loggingOptions": {
      "_seq": "Structured logging UI. Install: docker run --name seq -d -p 5341:80 -e ACCEPT_EULA=Y datalust/seq",
      "_loki": "For Grafana Loki, use Serilog.Sinks.Grafana.Loki package and configure: { Name: 'GrafanaLoki', Args: { uri: 'http://loki:3100' } }",
      "_splunk": "For Splunk, use Serilog.Sinks.Splunk package and configure: { Name: 'EventCollector', Args: { splunkHost: 'https://splunk:8088', eventCollectorToken: '${SPLUNK_TOKEN}' } }",
      "_elasticsearch": "For Elasticsearch/ELK, use Serilog.Sinks.Elasticsearch package and configure: { Name: 'Elasticsearch', Args: { nodeUris: 'http://elasticsearch:9200' } }",
      "_datadog": "For Datadog, use Serilog.Sinks.Datadog.Logs package and configure: { Name: 'DatadogLogs', Args: { apiKey: '${DATADOG_API_KEY}', source: 'honua-server' } }"
    }
  }
}
