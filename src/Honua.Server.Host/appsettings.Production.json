{
  "$schema": "https://json.schemastore.org/appsettings.json",

  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Microsoft.AspNetCore.Hosting.Diagnostics": "Information",
      "Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddleware": "Error",
      "System.Net.Http.HttpClient": "Warning",
      "Honua": "Information"
    }
  },

  "AllowedHosts": "",
  "_AllowedHostsNote": "REQUIRED: Set to actual domain(s), comma-separated. Example: yourdomain.com,*.yourdomain.com",

  "ConnectionStrings": {
    "Redis": "",
    "_RedisNote": "REQUIRED: Set to production Redis instance. Example: server:6379,password=secret,abortConnect=false,connectTimeout=5000"
  },

  "honua": {
    "metadata": {
      "provider": "",
      "path": "",
      "_providerNote": "REQUIRED: json, postgres, or s3",
      "_pathNote": "REQUIRED: Path to metadata file or connection string. For json: ./metadata/production-metadata.json"
    },

    "cors": {
      "allowAnyOrigin": false,
      "allowCredentials": true,
      "allowedOrigins": [],
      "_allowedOriginsNote": "REQUIRED: List of allowed frontend domains. Example: [\"https://app.yourdomain.com\", \"https://www.yourdomain.com\"]",
      "_securityNote": "allowAnyOrigin MUST be false in production"
    },

    "authentication": {
      "mode": "Local",
      "enforce": true,
      "quickStart": {
        "enabled": false
      },
      "local": {
        "enabled": true,
        "sessionLifetime": "08:00:00",
        "requireEmailVerification": false,
        "minPasswordLength": 16,
        "requireUppercase": true,
        "requireLowercase": true,
        "requireDigit": true,
        "requireSpecialCharacter": true,
        "maxFailedAttempts": 5,
        "lockoutDuration": "00:15:00",
        "signingKeyMode": "Persistent"
      },
      "jwt": {
        "issuer": "Honua.Server",
        "audience": "Honua.Clients",
        "expirationMinutes": 60,
        "clockSkewMinutes": 5
      },
      "_authNote": "Disable local auth if using SSO in production"
    },

    "security": {
      "apiKey": {
        "enabled": true
      }
    },

    "odata": {
      "enabled": true,
      "allowWrites": false,
      "defaultPageSize": 100,
      "maxPageSize": 1000,
      "emitWktShadowProperties": true
    }
  },

  "TrustedProxies": [],
  "_TrustedProxiesNote": "REQUIRED if behind load balancer: [\"10.0.0.0/8\", \"172.16.0.0/12\"]",

  "RateLimiting": {
    "Enabled": true,
    "Default": {
      "PermitLimit": 100,
      "WindowMinutes": 1,
      "SegmentsPerWindow": 4,
      "QueueLimit": 10
    },
    "OgcApi": {
      "PermitLimit": 200,
      "WindowMinutes": 1,
      "SegmentsPerWindow": 4,
      "QueueLimit": 20
    },
    "OpenRosa": {
      "PermitLimit": 50,
      "WindowMinutes": 1,
      "SegmentsPerWindow": 4,
      "QueueLimit": 5
    },
    "Geoservices": {
      "PermitLimit": 150,
      "WindowMinutes": 1,
      "SegmentsPerWindow": 4,
      "QueueLimit": 15
    },
    "_rateLimitingNote": "Configure TrustedProxies if rate limiting by IP behind load balancer"
  },

  "RequestLimits": {
    "MaxBodySize": 1073741824
  },

  "Kestrel": {
    "Limits": {
      "MaxRequestBodySize": 104857600,
      "RequestHeadersTimeout": "00:00:30",
      "KeepAliveTimeout": "00:02:00"
    },
    "_kestrelNote": "MaxRequestBodySize: 100MB, adjust based on expected upload sizes"
  },

  "Performance": {
    "_comment": "Performance tuning settings for caching and connection pooling",
    "ResponseCache": {
      "MaxSizeMB": 100
    },
    "MemoryCache": {
      "MaxSizeMB": 200,
      "CompactionPercentage": 0.25,
      "ExpirationScanMinutes": 5
    },
    "_databaseNote": "Database connection pooling is configured via connection strings. Example: Host=localhost;Database=honua;MinPoolSize=2;MaxPoolSize=50;ConnectionLifetime=600"
  },

  "SchemaValidation": {
    "Enabled": true,
    "FailOnError": false,
    "AutoSyncSchema": true
  },

  "observability": {
    "_comment": "=== OBSERVABILITY CONFIGURATION (PRODUCTION) ===",
    "_note_1": "Metrics and request logging are ENABLED by default in production for monitoring",
    "_note_2": "Tracing exporter is set to 'none' - configure OTLP endpoint for distributed tracing",
    "_note_3": "All settings can be overridden via environment variables (e.g., observability__metrics__enabled=true)",

    "logging": {
      "jsonConsole": true,
      "_comment_jsonConsole": "JSON format for production log aggregation (Splunk, ELK, Loki, etc.)",
      "includeScopes": true
    },

    "metrics": {
      "enabled": true,
      "_comment_enabled": "✓ ENABLED: Metrics collection for Prometheus/Grafana monitoring",
      "endpoint": "/metrics",
      "_comment_endpoint": "Prometheus scrape endpoint. Requires authentication (Viewer role or higher)",
      "usePrometheus": true,
      "_comment_usePrometheus": "Prometheus text format for standard monitoring tools",
      "_environment_override": "Set observability__metrics__enabled=false to disable"
    },

    "tracing": {
      "exporter": "none",
      "_comment_exporter": "Distributed tracing exporter: 'none' (default), 'otlp' (Jaeger/Tempo), 'console' (debug)",
      "otlpEndpoint": null,
      "_comment_otlpEndpoint": "OTLP endpoint for distributed tracing (e.g., http://tempo:4317, http://jaeger:4317)",
      "_recommendation": "For production observability, set exporter='otlp' and configure otlpEndpoint",
      "_example_jaeger": "http://jaeger-collector:4317",
      "_example_tempo": "http://tempo:4317",
      "_example_cloud": "https://otlp.nr-data.net:4317 (New Relic), https://api.honeycomb.io (Honeycomb)",
      "_environment_override": "observability__tracing__exporter=otlp and observability__tracing__otlpEndpoint=http://tempo:4317"
    },

    "requestLogging": {
      "enabled": true,
      "_comment_enabled": "✓ ENABLED: HTTP request/response logging for audit trails and troubleshooting",
      "logHeaders": false,
      "_comment_logHeaders": "Disabled by default (may contain sensitive auth tokens). Enable only for debugging",
      "slowThresholdMs": 5000,
      "_comment_slowThresholdMs": "Log slow requests exceeding 5 seconds for performance monitoring"
    }
  },

  "Serilog": {
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "formatter": "Serilog.Formatting.Compact.CompactJsonFormatter, Serilog.Formatting.Compact"
        }
      }
    ],
    "_serilogNote": "Using compact JSON format for log aggregation systems"
  }
}
