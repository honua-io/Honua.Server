<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="HonuaField.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:HonuaField"
    xmlns:views="clr-namespace:HonuaField.Views"
    xmlns:viewmodels="clr-namespace:HonuaField.ViewModels"
    x:DataType="viewmodels:AppShellViewModel"
    Title="Honua Field"
    FlyoutBackgroundColor="{StaticResource BackgroundPrimary}">

    <!-- FlyoutHeader with user profile -->
    <Shell.FlyoutHeader>
        <Grid Padding="20"
              BackgroundColor="{StaticResource PrimaryBlue}"
              HeightRequest="200">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- App Title -->
            <Label Grid.Row="0"
                   Text="Honua Field"
                   Style="{StaticResource H3}"
                   TextColor="{StaticResource White}"
                   Margin="0,0,0,16" />

            <!-- User Avatar/Initials -->
            <Frame Grid.Row="1"
                   WidthRequest="80"
                   HeightRequest="80"
                   CornerRadius="40"
                   BackgroundColor="{StaticResource White}"
                   Padding="0"
                   HasShadow="False"
                   HorizontalOptions="Start"
                   VerticalOptions="Center">
                <Label Text="{Binding UserInitials}"
                       Style="{StaticResource H2}"
                       TextColor="{StaticResource PrimaryBlue}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />
            </Frame>

            <!-- User Info -->
            <VerticalStackLayout Grid.Row="2" Spacing="4">
                <Label Text="{Binding Username}"
                       Style="{StaticResource BodyLarge}"
                       TextColor="{StaticResource White}"
                       FontAttributes="Bold" />
                <Label Text="{Binding Email}"
                       Style="{StaticResource BodySmall}"
                       TextColor="{StaticResource White}"
                       Opacity="0.9" />

                <!-- Sync Status -->
                <HorizontalStackLayout Spacing="8" Margin="0,8,0,0">
                    <ActivityIndicator IsRunning="{Binding IsSyncing}"
                                     IsVisible="{Binding IsSyncing}"
                                     Color="{StaticResource White}"
                                     WidthRequest="16"
                                     HeightRequest="16"
                                     VerticalOptions="Center" />
                    <Label Text="{Binding SyncStatusText}"
                           Style="{StaticResource CaptionText}"
                           TextColor="{StaticResource White}"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Grid>
    </Shell.FlyoutHeader>

    <!-- FlyoutFooter with Logout -->
    <Shell.FlyoutFooter>
        <VerticalStackLayout Padding="16" Spacing="8">
            <BoxView HeightRequest="1" Color="{StaticResource BorderDefault}" />
            <Button Text="Logout"
                    Style="{StaticResource DangerButton}"
                    Command="{Binding LogoutCommand}" />
            <Label Text="{Binding Source={x:Static local:AppInfo.Current}, Path=VersionString, StringFormat='Version {0}'}"
                   Style="{StaticResource CaptionText}"
                   HorizontalOptions="Center"
                   Margin="0,8,0,0" />
        </VerticalStackLayout>
    </Shell.FlyoutFooter>

    <!-- Main App Navigation -->
    <FlyoutItem Title="Home" Icon="ðŸ ">
        <ShellContent Title="Dashboard"
                      ContentTemplate="{DataTemplate views:MainPage}"
                      Route="Main" />
    </FlyoutItem>

    <FlyoutItem Title="Map" Icon="ðŸ—ºï¸">
        <ShellContent Title="Map"
                      ContentTemplate="{DataTemplate views:MapPage}"
                      Route="Map" />
    </FlyoutItem>

    <FlyoutItem Title="Features" Icon="ðŸ“">
        <ShellContent Title="Features"
                      ContentTemplate="{DataTemplate views:FeatureListPage}"
                      Route="Features" />
    </FlyoutItem>

    <FlyoutItem Title="Profile" Icon="ðŸ‘¤">
        <ShellContent Title="Profile"
                      ContentTemplate="{DataTemplate views:ProfilePage}"
                      Route="Profile" />
    </FlyoutItem>

    <FlyoutItem Title="Settings" Icon="âš™ï¸">
        <ShellContent Title="Settings"
                      ContentTemplate="{DataTemplate views:SettingsPage}"
                      Route="Settings" />
    </FlyoutItem>

    <!-- Menu Items -->
    <MenuItem Text="Sync Now"
              Command="{Binding TriggerSyncCommand}"
              IconImageSource="sync.png" />

    <MenuItem Text="Help"
              Command="{Binding ShowHelpCommand}"
              IconImageSource="help.png" />

    <MenuItem Text="About"
              Command="{Binding ShowAboutCommand}"
              IconImageSource="info.png" />

</Shell>
