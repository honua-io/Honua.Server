@page "/examples/vr"
@inject IJSRuntime JS
@using Honua.MapSDK.Services.VR
@using Honua.MapSDK.Components.VR

<PageTitle>VR Example - Honua MapSDK</PageTitle>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-8">
            <h1>WebXR VR Headset Integration Example</h1>
            <p class="lead">
                Experience geospatial data in virtual reality using Meta Quest, HTC Vive, Valve Index,
                or any WebXR-compatible headset.
            </p>
        </div>
        <div class="col-md-4 text-right">
            @if (!inVR)
            {
                <button class="btn btn-primary btn-lg" @onclick="LaunchVRDemo">
                    ü•Ω Launch VR Demo
                </button>
            }
        </div>
    </div>

    @if (!inVR)
    {
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3>Quick Start Guide</h3>
                    </div>
                    <div class="card-body">
                        <h4>Requirements</h4>
                        <ul>
                            <li><strong>VR Headset:</strong> Meta Quest 2/3/Pro, HTC Vive, Valve Index, or WebXR-compatible device</li>
                            <li><strong>Browser:</strong> Meta Quest Browser, Chrome, Edge (with VR support enabled)</li>
                            <li><strong>HTTPS:</strong> WebXR requires secure context (HTTPS)</li>
                        </ul>

                        <h4>Features</h4>
                        <ul>
                            <li>‚úÖ Stereoscopic 3D rendering (72-90 Hz)</li>
                            <li>‚úÖ 6DOF tracking (position + rotation)</li>
                            <li>‚úÖ Hand controller support</li>
                            <li>‚úÖ Multiple locomotion modes (teleport, smooth, grab-move)</li>
                            <li>‚úÖ Geospatial data rendering (GeoJSON with Z coordinates)</li>
                            <li>‚úÖ Level of Detail (LOD) optimization</li>
                            <li>‚úÖ Terrain visualization</li>
                            <li>‚úÖ Haptic feedback</li>
                            <li>‚úÖ Performance monitoring</li>
                        </ul>

                        <h4>Supported Data</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Vector Data</h5>
                                <ul>
                                    <li>GeoJSON with Z coordinates</li>
                                    <li>3D buildings (extruded polygons)</li>
                                    <li>Infrastructure (pipelines, powerlines)</li>
                                    <li>Points of interest</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>Raster Data</h5>
                                <ul>
                                    <li>Terrain elevation (RGB-encoded tiles)</li>
                                    <li>Imagery (ortho photos)</li>
                                    <li>Heatmaps</li>
                                    <li>Weather overlays</li>
                                </ul>
                            </div>
                        </div>

                        <h4>Example Scenarios</h4>
                        <div class="example-scenarios">
                            <div class="scenario" @onclick='() => LoadScenario("buildings")'>
                                <h5>üè¢ Urban Buildings</h5>
                                <p>3D extruded buildings in San Francisco at 1:100 scale</p>
                            </div>
                            <div class="scenario" @onclick='() => LoadScenario("terrain")'>
                                <h5>üèîÔ∏è Terrain Visualization</h5>
                                <p>Elevation data with realistic terrain mesh</p>
                            </div>
                            <div class="scenario" @onclick='() => LoadScenario("infrastructure")'>
                                <h5>üõ†Ô∏è Infrastructure</h5>
                                <p>Underground utilities and pipelines in 3D</p>
                            </div>
                            <div class="scenario" @onclick='() => LoadScenario("drone")'>
                                <h5>üöÅ Drone Data</h5>
                                <p>Flight paths and captured imagery in VR</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h4>Controller Mapping</h4>
                    </div>
                    <div class="card-body">
                        <VRControllerPanel
                            LocomotionMode="@selectedLocomotion"
                            ShowControllerStatus="false" />
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h4>Configuration</h4>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Center Location:</label>
                            <input type="text" class="form-control" @bind="centerDescription" placeholder="e.g., San Francisco" />
                            <small class="text-muted">Lon: @center[0], Lat: @center[1]</small>
                        </div>

                        <div class="form-group">
                            <label>Scale (1:N):</label>
                            <input type="number" class="form-control" @bind="scale" min="1" max="10000" />
                            <small class="text-muted">Recommended: 100-1000 for urban areas</small>
                        </div>

                        <div class="form-group">
                            <label>Quality:</label>
                            <select class="form-control" @bind="quality">
                                <option value="low">Low (Best FPS)</option>
                                <option value="medium">Medium (Balanced)</option>
                                <option value="high">High (Best Quality)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Locomotion:</label>
                            <select class="form-control" @bind="selectedLocomotion">
                                <option value="teleport">Teleport (Most Comfortable)</option>
                                <option value="smooth">Smooth</option>
                                <option value="grab-move">Grab & Move</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h4>Code Example</h4>
                    </div>
                    <div class="card-body">
                        <pre><code>@@page "/my-vr-app"
@@using Honua.MapSDK.Components.VR

&lt;VRMapViewer
    MapId="main-map"
    InitialCenter="new[] { -122.4194, 37.7749 }"
/&gt;

@@code {
    // VR session is managed automatically
    // Users can enter/exit VR with UI controls
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <VRMapViewer
            MapId="example-vr-map"
            InitialCenter="@center" />
    }
</div>

@code {
    private bool inVR = false;
    private double[] center = new[] { -122.4194, 37.7749 }; // San Francisco
    private string centerDescription = "San Francisco, CA";
    private double scale = 100.0;
    private string quality = "medium";
    private string selectedLocomotion = "teleport";

    private void LaunchVRDemo()
    {
        inVR = true;
    }

    private void LoadScenario(string scenario)
    {
        switch (scenario)
        {
            case "buildings":
                center = new[] { -122.4194, 37.7749 }; // San Francisco
                centerDescription = "San Francisco, CA";
                scale = 100.0;
                break;

            case "terrain":
                center = new[] { -119.5383, 37.7490 }; // Yosemite
                centerDescription = "Yosemite National Park";
                scale = 500.0;
                break;

            case "infrastructure":
                center = new[] { -122.3321, 47.6062 }; // Seattle
                centerDescription = "Seattle, WA";
                scale = 50.0;
                break;

            case "drone":
                center = new[] { -122.0840, 37.4220 }; // Palo Alto
                centerDescription = "Palo Alto, CA";
                scale = 25.0;
                break;
        }

        StateHasChanged();
    }
}

<style>
    .example-scenarios {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .scenario {
        border: 2px solid #007bff;
        border-radius: 8px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .scenario:hover {
        background: #e7f3ff;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .scenario h5 {
        margin-top: 0;
        color: #007bff;
    }

    .scenario p {
        margin: 0;
        font-size: 14px;
        color: #666;
    }

    .card {
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .card-header {
        background: #f8f9fa;
        border-bottom: 2px solid #007bff;
    }

    pre {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
    }

    code {
        color: #d63384;
    }
</style>
