@using Honua.Admin.Blazor.Shared.Models
@using MudBlazor

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            Services Using "@DataSourceId"
        </MudText>
    </TitleContent>
    <DialogContent>
        @if (Services == null || !Services.Any())
        {
            <MudAlert Severity="Severity.Info">
                No services are using this data source.
            </MudAlert>
        }
        else
        {
            <MudText Typo="Typo.body2" Class="mb-4">
                The following @Services.Count service(s) are using this data source:
            </MudText>
            <MudList>
                @foreach (var service in Services)
                {
                    <MudListItem>
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                            <MudIcon Icon="@GetServiceIcon(service.ServiceType)" Color="@GetServiceColor(service.ServiceType)" />
                            <div>
                                <MudText Typo="Typo.body1"><b>@service.Title</b></MudText>
                                <MudText Typo="Typo.caption">@service.Id (@service.ServiceType)</MudText>
                            </div>
                            @if (!service.Enabled)
                            {
                                <MudChip Size="Size.Small" Color="Color.Default">Disabled</MudChip>
                            }
                            @if (service.LayerCount > 0)
                            {
                                <MudChip Size="Size.Small" Color="Color.Info">@service.LayerCount layer(s)</MudChip>
                            }
                        </MudStack>
                    </MudListItem>
                    <MudDivider />
                }
            </MudList>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Close" Variant="Variant.Filled" Color="Color.Primary">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private MudDialogInstance MudDialog { get; set; } = default!;

    [Parameter]
    public string DataSourceId { get; set; } = string.Empty;

    [Parameter]
    public List<ServiceListItem> Services { get; set; } = new();

    private void Close() => MudDialog.Close();

    private string GetServiceIcon(string serviceType)
    {
        return serviceType.ToLowerInvariant() switch
        {
            "wms" => Icons.Material.Filled.Map,
            "wfs" => Icons.Material.Filled.VectorSquare,
            "wmts" => Icons.Material.Filled.GridOn,
            _ => Icons.Material.Filled.Layers
        };
    }

    private Color GetServiceColor(string serviceType)
    {
        return serviceType.ToLowerInvariant() switch
        {
            "wms" => Color.Primary,
            "wfs" => Color.Success,
            "wmts" => Color.Info,
            _ => Color.Default
        };
    }
}
