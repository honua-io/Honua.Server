@inject IDialogService DialogService

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">@Title</MudText>
    </TitleContent>
    <DialogContent>
        <MudStack Spacing="3" AlignItems="AlignItems.Center" Class="pa-4">
            <MudProgressCircular Color="Color.Primary"
                                 Indeterminate="false"
                                 Size="Size.Large"
                                 Value="@ProgressPercentage" />
            <MudText Typo="Typo.h6">@ProgressPercentage%</MudText>
            <MudText>@Message</MudText>
            <MudText Typo="Typo.body2" Color="Color.Secondary">
                @Current of @Total
            </MudText>
            @if (SuccessCount > 0 || FailedCount > 0)
            {
                <MudDivider Class="my-2" />
                <MudStack Row="true" Spacing="4">
                    @if (SuccessCount > 0)
                    {
                        <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                            <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" Size="Size.Small" />
                            <MudText Color="Color.Success">@SuccessCount succeeded</MudText>
                        </MudStack>
                    }
                    @if (FailedCount > 0)
                    {
                        <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                            <MudIcon Icon="@Icons.Material.Filled.Error" Color="Color.Error" Size="Size.Small" />
                            <MudText Color="Color.Error">@FailedCount failed</MudText>
                        </MudStack>
                    }
                </MudStack>
            }
        </MudStack>
    </DialogContent>
</MudDialog>

@code {
    [CascadingParameter]
    MudDialogInstance? MudDialog { get; set; }

    [Parameter]
    public string Title { get; set; } = "Processing...";

    [Parameter]
    public string Message { get; set; } = string.Empty;

    [Parameter]
    public int Current { get; set; }

    [Parameter]
    public int Total { get; set; }

    [Parameter]
    public int SuccessCount { get; set; }

    [Parameter]
    public int FailedCount { get; set; }

    private double ProgressPercentage => Total > 0 ? Math.Round((double)Current / Total * 100, 0) : 0;

    public void UpdateProgress(int current, int total, string? message = null, int? successCount = null, int? failedCount = null)
    {
        Current = current;
        Total = total;
        if (message != null)
            Message = message;
        if (successCount.HasValue)
            SuccessCount = successCount.Value;
        if (failedCount.HasValue)
            FailedCount = failedCount.Value;
        StateHasChanged();
    }
}
