{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://honua.dev/schemas/metadata.schema.json",
  "title": "Honua Metadata",
  "type": "object",
  "required": ["catalog", "folders", "services", "layers", "dataSources"],
  "$defs": {
    "link": {
      "type": "object",
      "required": ["href"],
      "properties": {
        "href": { "type": "string", "minLength": 1 },
        "rel": { "type": "string" },
        "type": { "type": "string" },
        "title": { "type": "string" }
      }
    },
    "extent": {
      "type": "object",
      "properties": {
        "bbox": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "array",
                "minItems": 4,
                "items": { "type": "number" }
              }
            },
            {
              "type": "array",
              "minItems": 4,
              "items": { "type": "number" }
            }
          ]
        },
        "crs": { "type": "string" },
        "temporal": {
          "type": "object",
          "properties": {
            "interval": {
              "type": "array",
              "items": {
                "type": "array",
                "minItems": 2,
                "prefixItems": [
                  { "type": ["string", "null" ] },
                  { "type": ["string", "null" ] }
                ],
                "items": false
              }
            },
            "trs": { "type": "string" }
          }
        }
      }
    },
    "query": {
      "type": "object",
      "properties": {
        "maxRecordCount": { "type": "integer", "minimum": 1 },
        "supportedParameters": {
          "type": "array",
          "items": { "type": "string" }
        },
        "autoFilter": {
          "type": "object",
          "properties": {
            "cql": { "type": "string" }
          }
        }
      }
    },
    "storage": {
      "type": "object",
      "properties": {
        "table": { "type": "string" },
        "geometryColumn": { "type": "string" },
        "primaryKey": { "type": "string" },
        "temporalColumn": { "type": "string" },
        "srid": { "type": "integer" },
        "crs": { "type": "string" }
      }
    },
    "layerAttachments": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "storageProfileId": { "type": "string", "minLength": 1 },
        "maxSizeMiB": { "type": "integer", "minimum": 1 },
        "allowedContentTypes": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "disallowedContentTypes": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "requireGlobalIds": { "type": "boolean" },
        "returnPresignedUrls": { "type": "boolean" },
        "exposeOgcLinks": { "type": "boolean" }
      }
    },
    "field": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "alias": { "type": "string" },
        "type": { "type": "string" },
        "storageType": { "type": "string" },
        "nullable": { "type": "boolean" },
        "editable": { "type": "boolean" },
        "maxLength": { "type": "integer", "minimum": 1 },
        "precision": { "type": "integer", "minimum": 0 },
        "scale": { "type": "integer", "minimum": 0 }
      }
    },
    "ogcService": {
      "type": "object",
      "properties": {
        "collectionsEnabled": { "type": "boolean" },
        "itemLimit": { "type": "integer", "minimum": 1 },
        "defaultCrs": { "type": "string" },
        "additionalCrs": {
          "type": "array",
          "items": { "type": "string" }
        },
        "conformanceClasses": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "simpleStyle": {
      "type": "object",
      "properties": {
        "label": { "type": "string" },
        "description": { "type": "string" },
        "symbolType": { "type": "string" },
        "fillColor": { "type": "string" },
        "strokeColor": { "type": "string" },
        "strokeWidth": { "type": "number", "minimum": 0 },
        "strokeStyle": { "type": "string" },
        "iconHref": { "type": "string" },
        "size": { "type": "number", "minimum": 0 },
        "opacity": { "type": "number", "minimum": 0, "maximum": 1 }
      }
    },
    "uniqueValueStyleClass": {
      "type": "object",
      "required": ["value"],
      "properties": {
        "value": { "type": "string" },
        "symbol": { "$ref": "#/$defs/simpleStyle" }
      }
    },
    "uniqueValueStyle": {
      "type": "object",
      "required": ["field", "classes"],
      "properties": {
        "field": { "type": "string", "minLength": 1 },
        "defaultSymbol": { "$ref": "#/$defs/simpleStyle" },
        "classes": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/uniqueValueStyleClass" }
        }
      }
    },
    "styleRuleFilter": {
      "type": "object",
      "properties": {
        "field": { "type": "string" },
        "value": { "type": "string" }
      }
    },
    "styleRule": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "default": { "type": "boolean" },
        "minScale": { "type": "number", "minimum": 0 },
        "maxScale": { "type": "number", "minimum": 0 },
        "filter": { "$ref": "#/$defs/styleRuleFilter" },
        "symbolizer": { "$ref": "#/$defs/simpleStyle" }
      }
    },
    "style": {
      "type": "object",
      "required": ["id"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "title": { "type": "string" },
        "renderer": { "type": "string" },
        "format": { "type": "string" },
        "geometryType": { "type": "string" },
        "rules": {
          "type": "array",
          "maxItems": 25,
          "items": { "$ref": "#/$defs/styleRule" }
        },
        "simple": { "$ref": "#/$defs/simpleStyle" },
        "uniqueValue": { "$ref": "#/$defs/uniqueValueStyle" }
      }
    }
  },
  "properties": {
    "catalog": {
      "type": "object",
      "required": ["id"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "version": { "type": "string" },
        "links": {
          "type": "array",
          "items": { "$ref": "#/$defs/link" }
        },
        "keywords": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "folders": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id"],
        "properties": {
          "id": { "type": "string", "minLength": 1 },
          "title": { "type": "string" },
          "order": { "type": "integer" }
        }
      }
    },
    "dataSources": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "provider", "connectionString"],
        "properties": {
          "id": { "type": "string", "minLength": 1 },
          "provider": { "type": "string", "minLength": 1 },
          "connectionString": { "type": "string", "minLength": 1 }
        }
      }
    },
    "services": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "folderId", "serviceType", "dataSourceId"],
        "properties": {
          "id": { "type": "string", "minLength": 1 },
          "title": { "type": "string" },
          "folderId": { "type": "string", "minLength": 1 },
          "serviceType": { "type": "string", "minLength": 1 },
          "dataSourceId": { "type": "string", "minLength": 1 },
          "enabled": { "type": "boolean" },
          "description": { "type": "string" },
          "keywords": {
            "type": "array",
            "items": { "type": "string" }
          },
          "links": {
            "type": "array",
            "items": { "$ref": "#/$defs/link" }
          },
          "ogc": { "$ref": "#/$defs/ogcService" },
          "esri": { "type": "object" }
        }
      }
    },
    "layers": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "serviceId", "geometryType", "idField", "geometryField"],
        "properties": {
          "id": { "type": "string", "minLength": 1 },
          "serviceId": { "type": "string", "minLength": 1 },
          "title": { "type": "string" },
          "description": { "type": "string" },
          "geometryType": { "type": "string", "minLength": 1 },
          "idField": { "type": "string", "minLength": 1 },
          "displayField": { "type": "string" },
          "geometryField": { "type": "string", "minLength": 1 },
          "crs": {
            "type": "array",
            "items": { "type": "string" }
          },
          "keywords": {
            "type": "array",
            "items": { "type": "string" }
          },
          "links": {
            "type": "array",
            "items": { "$ref": "#/$defs/link" }
          },
          "extent": { "$ref": "#/$defs/extent" },
          "query": { "$ref": "#/$defs/query" },
          "storage": { "$ref": "#/$defs/storage" },
          "fields": {
            "type": "array",
            "items": { "$ref": "#/$defs/field" }
          },
          "attachments": { "$ref": "#/$defs/layerAttachments" },
          "itemType": { "type": "string" },
          "minScale": { "type": "number", "minimum": 0 },
          "maxScale": { "type": "number", "minimum": 0 }
        }
      }
    },
    "styles": {
      "type": "array",
      "items": { "$ref": "#/$defs/style" }
    }
  }
}
