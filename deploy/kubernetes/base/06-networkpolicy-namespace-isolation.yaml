---
# Namespace Isolation Network Policy
# This policy prevents pods in other namespaces from accessing pods in the Honua namespace,
# unless explicitly allowed by namespace selectors in other policies.
#
# This implements namespace-level network segmentation for defense in depth.

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: namespace-isolation
  namespace: honua
  labels:
    app: honua
    component: network-policy
    policy-type: namespace-isolation
  annotations:
    description: "Prevent cross-namespace traffic except from allowed namespaces"
    security.policy: "namespace-segmentation"
    priority: "2"

spec:
  # Apply to all pods in the namespace
  podSelector: {}

  policyTypes:
  - Ingress

  ingress:
  # Rule 1: Allow traffic from within the same namespace
  # Pods can communicate with each other within the namespace
  - from:
    - podSelector: {}

  # Rule 2: Allow traffic from Ingress Controller namespace
  # Required for external HTTP/HTTPS access
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
    - namespaceSelector:
        matchLabels:
          ingress-controller: "true"

  # Rule 3: Allow traffic from Monitoring namespace
  # Required for metrics scraping and monitoring
  - from:
    - namespaceSelector:
        matchLabels:
          name: monitoring
    - namespaceSelector:
        matchLabels:
          monitoring: "true"

  # Rule 4: Allow traffic from Observability namespace
  # Required for distributed tracing and log collection
  - from:
    - namespaceSelector:
        matchLabels:
          name: observability
    - namespaceSelector:
        matchLabels:
          observability: "true"

  # Note: All other namespaces are implicitly denied
