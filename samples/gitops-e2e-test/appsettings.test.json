{
  "_comment": "GitOps E2E Test Configuration",
  "_instructions": "Copy this file to src/Honua.Server.Host/appsettings.Development.json or merge GitOps section into your existing configuration",
  "_warning": "This is a TEST configuration with minimal security. DO NOT use in production.",

  "TrustedProxies": [],

  "Serilog": {
    "Using": [ "Serilog.Sinks.Console", "Serilog.Sinks.File" ],
    "MinimumLevel": {
      "Default": "Debug",
      "Override": {
        "Microsoft": "Information",
        "Microsoft.AspNetCore": "Warning",
        "System": "Warning",
        "Honua.Server.Core.GitOps": "Debug"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "outputTemplate": "[{Timestamp:HH:mm:ss} {Level:u3}] [{SourceContext}] {Message:lj}{NewLine}{Exception}"
        }
      },
      {
        "Name": "File",
        "Args": {
          "path": "logs/honua-.log",
          "rollingInterval": "Day",
          "retainedFileCountLimit": 7,
          "outputTemplate": "{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} [{Level:u3}] [{SourceContext}] {Message:lj} {Properties:j}{NewLine}{Exception}"
        }
      }
    ],
    "Enrich": [ "FromLogContext", "WithMachineName", "WithThreadId" ]
  },

  "Logging": {
    "LogLevel": {
      "Default": "Debug",
      "Microsoft.AspNetCore": "Warning",
      "Honua.Server.Core.GitOps": "Debug"
    }
  },

  "observability": {
    "logging": {
      "jsonConsole": false,
      "includeScopes": true
    },
    "metrics": {
      "enabled": true,
      "endpoint": "/metrics",
      "usePrometheus": true
    }
  },

  "AllowedHosts": "*",

  "_GitOps_Comment": "=== GitOps Configuration for E2E Testing ===",
  "GitOps": {
    "_Enabled_Comment": "Set to true to enable GitOps functionality",
    "Enabled": true,

    "_RepositoryPath_Comment": "Path to the Git repository containing configuration. Created by init-test-repo.sh",
    "RepositoryPath": "/tmp/honua-gitops-test-repo",

    "_StateDirectory_Comment": "Directory for storing deployment state and approval records",
    "StateDirectory": "/tmp/honua-gitops-state",

    "_DryRun_Comment": "If true, changes are detected but not applied (testing mode)",
    "DryRun": false,

    "_Watcher_Comment": "Git polling configuration",
    "Watcher": {
      "_Branch_Comment": "Git branch to watch for changes",
      "Branch": "main",

      "_Environment_Comment": "Which environment to reconcile (development, staging, production)",
      "Environment": "development",

      "_PollIntervalSeconds_Comment": "How often to check for Git changes (seconds). Default: 30, Test: 10 for faster feedback",
      "PollIntervalSeconds": 10
    },

    "_Credentials_Comment": "Git authentication (optional for local testing, required for remote repos)",
    "Credentials": {
      "_Username_Comment": "Git username or leave empty for no auth",
      "Username": "",

      "_Password_Comment": "Git password or personal access token",
      "Password": ""
    }
  },

  "_Honua_Comment": "=== Honua Core Configuration ===",
  "honua": {
    "pagination": {
      "defaultLimit": 10,
      "maxLimit": 1000,
      "stacCollectionDefaultLimit": 10,
      "stacCollectionMaxLimit": 100,
      "stacItemDefaultLimit": 10,
      "stacItemMaxLimit": 1000
    },

    "apiVersioning": {
      "defaultVersion": "1.0",
      "assumeDefaultVersionWhenUnspecified": true,
      "reportApiVersions": true,
      "versioningMethod": "UrlSegment"
    },

    "authentication": {
      "_mode_Comment": "Authentication mode: Local, OAuth, or None",
      "mode": "None",
      "requireAuthentication": false
    },

    "cors": {
      "_enabled_Comment": "Enable CORS for development testing",
      "enabled": true,
      "allowedOrigins": ["*"],
      "allowedMethods": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
      "allowedHeaders": ["*"],
      "allowCredentials": false
    },

    "rateLimiting": {
      "_enabled_Comment": "Disable rate limiting for testing",
      "enabled": false
    },

    "_metadata_Comment": "Metadata registry configuration - Uses Git-sourced metadata when GitOps is enabled",
    "metadata": {
      "provider": "File",
      "reloadOnChange": true,
      "_configPath_Comment": "This path is overridden by GitOps reconciled configuration",
      "configPath": "/tmp/honua-gitops-test-repo/reconciled/development/metadata.json"
    },

    "_datasources_Comment": "Datasource configuration - Uses Git-sourced datasources when GitOps is enabled",
    "datasources": {
      "provider": "File",
      "_configPath_Comment": "This path is overridden by GitOps reconciled configuration",
      "configPath": "/tmp/honua-gitops-test-repo/reconciled/development/datasources.json"
    },

    "caching": {
      "enabled": true,
      "defaultExpiration": "00:05:00",
      "metadataExpiration": "00:10:00"
    },

    "performance": {
      "maxQueryTimeout": 30000,
      "defaultPageSize": 100,
      "maxPageSize": 10000
    }
  },

  "_Resilience_Comment": "=== Resilience Configuration ===",
  "Resilience": {
    "Hedging": {
      "Enabled": false,
      "MaxHedgedAttempts": 2,
      "DelayMilliseconds": 50,
      "TimeoutSeconds": 5
    }
  },

  "_ConnectionStrings_Comment": "=== Database Connection Strings (Optional for Testing) ===",
  "ConnectionStrings": {
    "_Comment": "These are optional for GitOps testing. The test scenarios use mock data. For local testing with real DB, set HONUA_TEST_DB_PASSWORD environment variable.",
    "PostgreSQL": "Host=localhost;Port=5432;Database=honua_test;Username=honua;Password=${HONUA_TEST_DB_PASSWORD:-YOUR_TEST_PASSWORD}",
    "Redis": ""
  },

  "_Testing_Comment": "=== Testing-Specific Configuration ===",
  "Testing": {
    "EnableDetailedErrors": true,
    "DisableHealthChecks": false,
    "EnableTestEndpoints": true
  },

  "_Notes": [
    "This configuration is optimized for local E2E testing of GitOps functionality",
    "Poll interval is set to 10 seconds for faster test feedback (default is 30)",
    "Logging is set to Debug level for GitOps components",
    "DryRun is false - changes will actually be applied",
    "No authentication or rate limiting for easier testing",
    "Metadata and datasource paths point to reconciled GitOps configuration",
    "",
    "To test different environments:",
    "- Change Watcher.Environment to 'staging' or 'production'",
    "- Ensure corresponding environment directory exists in Git repo",
    "",
    "To test with approval workflow:",
    "- Change Watcher.Environment to 'production'",
    "- Production environment requires approval for high-risk changes",
    "",
    "To test DryRun mode:",
    "- Set DryRun to true",
    "- Changes will be detected and logged but not applied",
    "",
    "For remote Git repositories:",
    "- Set RepositoryPath to local clone of remote repo",
    "- Provide Credentials.Username and Credentials.Password",
    "- Ensure Git repository is accessible"
  ],

  "_Troubleshooting": {
    "GitWatcher_not_detecting_changes": [
      "Check GitOps.Enabled is true",
      "Verify RepositoryPath exists and is a valid Git repo",
      "Ensure Watcher.Environment matches the directory you're modifying",
      "Wait for full PollIntervalSeconds to elapse",
      "Check logs for 'GitWatcher started' message"
    ],
    "Reconciliation_fails": [
      "Check logs for detailed error messages",
      "Validate JSON files: cat metadata.json | jq '.'",
      "Verify file permissions on StateDirectory",
      "Check that metadata/datasource schemas are valid"
    ],
    "Metadata_not_updating": [
      "Check for 'reloaded metadata registry' in logs",
      "Verify reconciled configuration was written",
      "Restart Honua if metadata registry is not reloading",
      "Check metadata.configPath points to reconciled config"
    ],
    "Performance_issues": [
      "Increase PollIntervalSeconds if too much log noise",
      "Disable Debug logging after initial testing",
      "Check Git repository size and complexity"
    ]
  }
}
