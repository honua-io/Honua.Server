# Example Terraform Variables for Google Cloud Run Deployment
# Copy this file to terraform.tfvars and customize for your environment

# ==================== Required Variables ====================
project_id      = "my-gcp-project-id"
container_image = "gcr.io/my-gcp-project-id/honua:latest"

# ==================== Environment Configuration ====================
environment           = "production"  # dev, staging, or production
region                = "us-central1"
service_name          = "honua"
aspnetcore_environment = "Production"  # Development, Staging, or Production

# ==================== Scaling Configuration ====================
min_instances          = 1    # 0 for true serverless, 1+ for always-on
max_instances          = 100
cpu_limit              = "2"   # 1, 2, 4, or 8
memory_limit           = "2Gi" # 512Mi, 1Gi, 2Gi, 4Gi, 8Gi, 16Gi
max_concurrent_requests = 80
request_timeout        = 300   # seconds (max 3600)
cpu_always_allocated   = true  # false saves costs but increases cold start latency

# ==================== Database Configuration ====================
create_database           = true
database_name             = "honua"
db_username               = "honua"
postgres_version          = "POSTGRES_15"  # POSTGRES_14, POSTGRES_15, or POSTGRES_16
db_tier                   = "db-g1-small"  # db-f1-micro, db-g1-small, db-custom-2-7680, etc.
db_availability_type      = "ZONAL"        # ZONAL or REGIONAL
db_disk_size              = 10             # GB
db_max_disk_size          = 100            # GB
db_max_connections        = "100"
db_backup_retention_days  = 7
db_point_in_time_recovery = true
db_deletion_protection    = true           # Prevent accidental deletion

# ==================== Network Configuration ====================
enable_vpc_connector        = true
vpc_network_name            = "default"
vpc_network_id              = "projects/my-gcp-project-id/global/networks/default"
vpc_connector_cidr          = "10.8.0.0/28"  # Must not overlap with existing subnets
vpc_connector_machine_type  = "e2-micro"
vpc_connector_max_instances = 3

# ==================== Load Balancer Configuration ====================
create_load_balancer = true
custom_domains       = ["api.honua.example.com", "gis.example.com"]
lb_log_sample_rate   = 1.0  # 0.0 to 1.0 (1.0 = log all requests)

# ==================== CDN Configuration ====================
enable_cdn      = true
cdn_default_ttl = 3600  # 1 hour (good for tiles)
cdn_max_ttl     = 86400 # 24 hours (metadata)
cdn_client_ttl  = 3600  # 1 hour

# ==================== Security Configuration ====================
allow_unauthenticated = true  # Set to false to require authentication

# Grant access to specific users/groups (only if allow_unauthenticated = false)
authorized_members = [
  # "user:alice@example.com",
  # "group:gis-team@example.com",
  # "serviceAccount:app@project.iam.gserviceaccount.com",
]

# Cloud Armor security
enable_cloud_armor         = true
rate_limit_threshold       = 1000  # requests per minute (0 to disable)
enable_adaptive_protection = false # Advanced DDoS protection (additional cost)

# Block specific IP ranges
blocked_ip_ranges = [
  # "192.0.2.0/24",
  # "198.51.100.0/24",
]

# ==================== Application Configuration ====================
cors_origins = [
  "https://honua.example.com",
  "https://app.honua.example.com",
  # "http://localhost:3000",  # Add for local development
]

gdal_cache_max = "512"  # MB

# Additional environment variables
additional_env_vars = {
  # FEATURE_FLAG_NEW_RENDERER = "true"
  # LOG_LEVEL                 = "Information"
  # MAX_QUERY_EXTENT          = "1000000"  # square meters
}

# ==================== Health Check ====================
health_check_path = "/health"

# ==================== Additional Features ====================
enable_gcs_access = true  # Grant Cloud Storage read access

# ==================== Labels ====================
labels = {
  team        = "platform"
  cost_center = "engineering"
  application = "honua"
  tier        = "production"
}

# ==================== Cost Optimization Notes ====================
#
# For Development:
# - min_instances = 0
# - db_tier = "db-f1-micro"
# - db_availability_type = "ZONAL"
# - create_load_balancer = false
# - enable_cloud_armor = false
# - db_backup_retention_days = 3
# - db_deletion_protection = false
#
# For Staging:
# - min_instances = 0
# - db_tier = "db-g1-small"
# - db_availability_type = "ZONAL"
# - create_load_balancer = true
# - enable_cloud_armor = true
#
# For Production:
# - min_instances = 2 (or more for low latency)
# - db_tier = "db-custom-4-16384" (or larger)
# - db_availability_type = "REGIONAL"
# - create_load_balancer = true
# - enable_cloud_armor = true
# - enable_adaptive_protection = true
# - db_backup_retention_days = 30
# - db_deletion_protection = true
